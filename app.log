DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005637s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006614s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007627s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008484s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781044 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.127s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.745s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781045 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781046 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026B8D2D1B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026B8CBB6C80>, 35739.281)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026B8D218510>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781047 is handled. Duration 343 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026B8D1F2450>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026B8CBB6EB0>, 35754.515)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026B8D147750>
INFO:aiogram.event:Update id=657781048 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781049 is handled. Duration 358 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007105s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008129s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008997s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009851s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00116s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781050 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.793s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.161s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781051 is handled. Duration 264 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781052 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001ADA87A1C90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001ADA80AAC80>, 35825.359)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001ADA87A1750>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781053 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001ADA87E1250>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001ADA80AAEB0>, 35843.078)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001ADA87E0B50>
INFO:aiogram.event:Update id=657781054 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781055 is handled. Duration 327 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00144s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008239s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009405s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01027s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01126s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00152s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781056 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.549s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.135s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781057 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781058 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000180BC2AD650>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000180BBBEAC80>, 35907.953)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000180BC2AD150>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781059 is handled. Duration 281 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000180BC31CB10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000180BBBEAEB0>, 35923.625)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000180BC2369D0>
INFO:aiogram.event:Update id=657781060 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781061 is handled. Duration 266 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005597s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008306s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009473s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01046s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781062 is handled. Duration 391 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.403s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.18s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781063 is handled. Duration 406 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781064 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E3D4411A50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E3D3CCEC80>, 35982.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E3D4411A10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781065 is handled. Duration 421 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E3D42A77D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E3D3CCE430>, 35997.843)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E3D42A7950>
INFO:aiogram.event:Update id=657781066 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781067 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005355s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006357s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00721s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00809s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781068 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.027s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.805s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781069 is handled. Duration 500 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00075s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781070 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000022CD6441090>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000022CD5D2AC80>, 36118.984)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000022CD6440B50>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781071 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000022CD63C8210>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000022CD5D2AEB0>, 36136.39)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000022CD63CAE50>
INFO:aiogram.event:Update id=657781072 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781073 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008378s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01077s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01232s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01347s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781074 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.172s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 146.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781075 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781076 is handled. Duration 186 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000027E7B34D9D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000027E7AC3AC10>, 36347.828)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000027E7B34D850>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781077 is handled. Duration 281 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000027E7AE27190>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000027E7AC3AEB0>, 36365.89)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000027E7B3BDF90>
INFO:aiogram.event:Update id=657781078 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781079 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005515s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00658s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007493s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008359s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00033s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781081 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.477s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.82s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781082 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781083 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021A9F362010>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021A9EC0EC80>, 36480.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021A9F361AD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781084 is handled. Duration 311 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021A9EC29290>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021A9EC0EEB0>, 36495.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021A9EC28B90>
INFO:aiogram.event:Update id=657781085 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781086 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00483s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006768s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008316s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00983s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781087 is handled. Duration 360 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.161s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 54.64s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781088 is handled. Duration 311 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781089 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B42EF02110>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B42E7C6F20>, 36690.75)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B42EF01BD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781090 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B42E90A090>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B42E7C6120>, 36706.25)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B42E7E9950>
INFO:aiogram.event:Update id=657781091 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781092 is handled. Duration 280 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00159s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008085s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009645s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01081s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01192s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781093 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.315s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 13.03s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781094 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781095 is handled. Duration 186 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000183DC06E350>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000183DB8C6E40>, 36749.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000183DB8DD550>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781096 is handled. Duration 391 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000183DBF93ED0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000183DB8C63C0>, 36767.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000183DC0ACF10>
INFO:aiogram.event:Update id=657781097 is handled. Duration 264 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781098 is handled. Duration 313 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007496s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008987s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009988s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01093s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781099 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.287s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.804s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781100 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781101 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00130s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000187E17E1810>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000187E10BACF0>, 36865.156)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000187E17E1310>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781102 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000187E1644F10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000187E10BA4A0>, 36878.5)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000187E15B8590>
INFO:aiogram.event:Update id=657781103 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781104 is handled. Duration 219 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005088s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006037s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006911s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007837s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781105 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 4.045s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 7.384s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781106 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781107 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000203FDC71B90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000203FD59AC80>, 36987.453)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000203FDB93750>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781108 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000203FDA68310>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000203FD59AEB0>, 37001.078)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000203FDA68B90>
INFO:aiogram.event:Update id=657781109 is handled. Duration 264 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781110 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02499s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02688s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02892s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03091s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00049s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00054s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00047s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.234s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.2356s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.2365s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.2377s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.2403s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00114s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00099s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00135s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00143s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00105s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00153s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00021s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00115s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781115 is handled. Duration 264 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.818s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 20.46s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781116 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781117 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781117 by bot id=7128547705
IndexError: list index out of range
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\handlers\user_private.py", line 60, in user_menu
    text, reply_markup = await get_menu_content(
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\handlers\menu_processing.py", line 104, in get_menu_content
    return await subscriptions(session, level, category, page)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\handlers\menu_processing.py", line 72, in subscriptions
    subscribe = paginator.get_page()[0]
                ~~~~~~~~~~~~~~~~~~~~^^^
IndexError: list index out of range
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 6.619s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781118 is handled. Duration 171 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781119 is handled. Duration 358 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781120 is handled. Duration 141 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781121 is handled. Duration 187 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781122 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 58.34s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781123 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 61.08s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781124 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ('', 10, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781125 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 48.7s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781126 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 49.66s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 68.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781127 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.48s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781128 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F5479FE5D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001F547951630>, 178050.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001F5479D1E50>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781129 is handled. Duration 250 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F5477CC0D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001F547262900>, 178068.515)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001F5479D0290>
INFO:aiogram.event:Update id=657781130 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781131 is not handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01032s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01164s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01253s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01358s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781132 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.19s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.379s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781133 is handled. Duration 469 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781134 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E774CE0E10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E7745CADD0>, 178275.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E7745CF350>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781135 is handled. Duration 280 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E774D66A10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E7745CA4A0>, 178289.328)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E774D35850>
INFO:aiogram.event:Update id=657781136 is handled. Duration 235 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781137 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006152s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007463s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008421s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009481s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781138 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.208s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.626s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781139 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781140 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EFD7C318D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EFD74E6D60>, 178352.5)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EFD7BC0AD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781141 is handled. Duration 344 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EFD7B905D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EFD74E64A0>, 178366.828)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EFD7B91890>
INFO:aiogram.event:Update id=657781142 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781143 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008648s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0113s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01382s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01567s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781144 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.154s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.383s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781145 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781146 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000208B06610D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000208AFFAACF0>, 178422.593)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000208B0632590>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781147 is handled. Duration 250 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000208B06E8850>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000208AFFAAF20>, 178436.906)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000208B05E4250>
INFO:aiogram.event:Update id=657781148 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781149 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007258s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008463s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009664s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01074s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781150 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.348s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.139s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781151 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00138s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781152 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C2BB751950>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C2BB0AED60>, 178516.484)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C2BB0C8D10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781153 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C2BB7BDED0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C2BB0AE430>, 178532.078)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C2BB7BD650>
INFO:aiogram.event:Update id=657781154 is handled. Duration 235 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C2BB7B25D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C2BB0AF2A0>, 178537.937)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C2BB78CA10>
INFO:aiogram.event:Update id=657781155 is handled. Duration 233 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C2BB65B910>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C2BB02BC40>, 178553.062)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C2BB658290>
INFO:aiogram.event:Update id=657781156 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C2BB65BED0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C2BB02BC40>, 178557.171)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C2BB658810>
INFO:aiogram.event:Update id=657781157 is handled. Duration 280 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008934s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01007s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01102s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01195s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00036s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03417s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03641s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03756s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03862s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0398s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00095s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00103s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00119s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00104s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00012s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781158 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781159 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781160 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781161 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 1] [SSL: APPLICATION_DATA_AFTER_CLOSE_NOTIFY] application data after close notify (_ssl.c:2672)
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7128547705)
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005604s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006968s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008084s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009157s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00040s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0347s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03617s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0371s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03848s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0403s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00076s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00100s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00102s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00129s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00096s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00147s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781162 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.551s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 9.022s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781163 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781164 is not handled. Duration 14 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781164 by bot id=7128547705
IndexError: list index out of range
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\handlers\user_private.py", line 63, in user_menu
    text, reply_markup = await get_menu_content(
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\handlers\menu_processing.py", line 104, in get_menu_content
    return await subscriptions(session, level, category, page)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\handlers\menu_processing.py", line 72, in subscriptions
    subscribe = paginator.get_page()[0]
                ~~~~~~~~~~~~~~~~~~~~^^^
IndexError: list index out of range
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 5.929s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781165 is handled. Duration 171 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781166 is handled. Duration 406 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781167 is handled. Duration 110 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781168 is handled. Duration 140 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781169 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 48.31s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781170 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 49.84s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781171 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] (' ', 12, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781172 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 47.85s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781173 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 48.79s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 56.26s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781174 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 46.88s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781175 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000018764C295D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000018764E258D0>, 179552.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001876468B110>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781176 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00127s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007846s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009258s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0104s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01139s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00037s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00123s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00051s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00071s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03739s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03944s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04145s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04465s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04669s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00194s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00241s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00153s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00184s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00106s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781177 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781178 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781179 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781180 is handled. Duration 92 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 24.04s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781181 is handled. Duration 92 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 25.47s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781182 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ('123141', 12, 12.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781183 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781184 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.67s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 36.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781185 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781186 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781187 is not handled. Duration 250 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781187 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 60, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 28, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 16.93s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 51.16s ago] ()
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001DDEA24BC40>, 179632.39)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001DDEA246E90>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781188 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781189 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.28s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781190 is not handled. Duration 266 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781190 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 60, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 28, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006252s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007461s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008397s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009303s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00046s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00035s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0362s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03753s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03835s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03915s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04009s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00090s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00114s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00248s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00185s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00169s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00023s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781191 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781192 is handled. Duration 157 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781193 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781194 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 22.94s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781195 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 24.27s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781196 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] ('', 5, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781197 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781198 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.042s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 29.86s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781199 is handled. Duration 358 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781200 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000023A36B6B7D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000023A364CBCB0>, 179752.593)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000023A36B68E10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781201 is handled. Duration 233 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000023A36ABD710>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000023A3644BD20>, 179769.671)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000023A36ABE510>
INFO:aiogram.event:Update id=657781202 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781203 is handled. Duration 250 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006026s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007821s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01084s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01272s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00049s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00043s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03919s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04135s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04483s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04626s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04837s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00173s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00179s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00279s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00297s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00215s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00014s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00012s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781204 is handled. Duration 327 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781205 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781206 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781207 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 19.29s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781208 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 20.84s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781209 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('', 5, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781210 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781211 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.038s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 34.95s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781212 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781213 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00120s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025AC1019ED0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000025AC0A4FD20>, 179849.484)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000025AC0A6EE90>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781214 is handled. Duration 250 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025AC101BD10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000025AC09C7D20>, 179863.281)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000025AC0A6FA50>
INFO:aiogram.event:Update id=657781215 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781216 is handled. Duration 280 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005243s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006525s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007671s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009055s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781217 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781217 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 43, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:aiogram.event:Update id=657781218 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781218 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 43, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:aiogram.event:Update id=657781219 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781219 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 43, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:aiogram.event:Update id=657781220 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781220 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 43, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:aiogram.event:Update id=657781221 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781221 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 43, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:aiogram.event:Update id=657781222 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781222 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\payment_user_private.py", line 43, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005799s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006951s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007889s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008854s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781223 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.086s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.216s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781224 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781225 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001FCDC948690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001FCDC28EE40>, 179922.093)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001FCDC8F12D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781226 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001FCDC8F02D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001FCDC28DFD0>, 179935.609)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001FCDCA31650>
INFO:aiogram.event:Update id=657781227 is handled. Duration 391 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781228 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006689s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008269s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009349s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0103s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00112s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781229 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.775s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.254s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781230 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781231 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000238E22C5190>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000238E1BEEDD0>, 180015.812)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000238E22C4C90>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781232 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000238E2253310>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000238E1BEDF60>, 180030.484)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000238E23354D0>
INFO:aiogram.event:Update id=657781233 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781234 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781234 by bot id=7128547705
TypeError: process_successful_payment() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_link
    await process_successful_payment(message, session)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() takes 1 positional argument but 2 were given
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006277s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007209s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008086s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008931s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781236 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.9343s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.157s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781237 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781238 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D8512451D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D850B3EDD0>, 180052.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D851245190>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781239 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D8512CE610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D850B3E510>, 180066.781)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D8512CED50>
INFO:aiogram.event:Update id=657781240 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781241 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005907s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006969s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00791s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008822s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781242 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.31s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.313s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781243 is handled. Duration 484 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781244 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D19C378090>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D19BC9EDD0>, 180097.359)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D19BCAED10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781245 is handled. Duration 280 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D19C402F10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D19BC9F000>, 180110.875)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D19C403F90>
INFO:aiogram.event:Update id=657781246 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781247 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006802s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007846s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008696s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009561s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781248 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.121s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.718s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781249 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781250 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002A4325088D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002A431E1ADD0>, 180820.875)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002A42E490850>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781251 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002A432325AD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002A431E1A510>, 180833.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002A432324E90>
INFO:aiogram.event:Update id=657781252 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781253 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005641s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007412s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008519s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009438s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00033s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781254 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.11s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.188s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781255 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781256 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D594374A90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D593BCEDD0>, 180859.171)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D593BA2510>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781257 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D5943F2010>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D593BCDF60>, 180873.796)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D5943FC550>
INFO:aiogram.event:Update id=657781258 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781259 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006864s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00797s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008872s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009704s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781260 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.394s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.574s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781261 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781262 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001ABBED7E090>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001ABBE66EC80>, 181003.734)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001ABBED7D510>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781263 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001ABBEBEC490>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001ABBE66EEB0>, 181017.39)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001ABBEBB3350>
INFO:aiogram.event:Update id=657781264 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781265 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005476s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006618s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007876s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009854s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781266 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.085s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.444s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781267 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781268 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000248A77C1E10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000248A70EEC80>, 181048.375)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000248A77C1DD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781269 is handled. Duration 281 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000248A7801750>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000248A70EDE10>, 181062.218)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000248A7690790>
INFO:aiogram.event:Update id=657781270 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781271 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006131s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00787s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00893s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009812s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781272 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.173s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.885s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781273 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781274 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C9554EA650>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C9554F2C80>, 181100.64)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C95422DA10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781275 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C955C7D190>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C9554F1E10>, 181119.562)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C9554D0590>
INFO:aiogram.event:Update id=657781276 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781277 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005438s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006778s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008041s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009058s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781278 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.099s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.785s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781279 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781280 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000018C3BC90E10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000018C3B52AC80>, 181329.531)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000018C3BC90910>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781281 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000018C3BD087D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000018C3B52AEB0>, 181344.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000018C3BD0A390>
INFO:aiogram.event:Update id=657781282 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781283 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781283 by bot id=7128547705
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/missing
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 105, in process_successful_payment
    keyboard = InlineKeyboardMarkup()
               ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/missing
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005956s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007011s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007921s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0088s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781284 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.251s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.276s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781285 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781286 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000023025720A50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002302502ECF0>, 181397.984)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000230256471D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781287 is handled. Duration 280 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000230256008D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002302502EF20>, 181411.875)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000230204FA850>
INFO:aiogram.event:Update id=657781288 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781289 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005674s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006685s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007557s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00855s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781290 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.917s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 12.92s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781291 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781292 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00124s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001A193D62290>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001A19365EE40>, 189213.171)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001A193D61650>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781293 is handled. Duration 281 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001A193D9C990>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001A19365C520>, 189227.609)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001A193D9C250>
INFO:aiogram.event:Update id=657781294 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781295 is handled. Duration 312 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005473s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006462s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008098s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01048s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00112s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781296 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.077s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.466s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781297 is handled. Duration 422 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781298 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000225B3EC7790>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000225B3EDECF0>, 189422.5)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000225B3EEC050>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781299 is handled. Duration 328 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000225B45432D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000225B3EDE430>, 189436.203)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000225B43AA390>
INFO:aiogram.event:Update id=657781300 is handled. Duration 328 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000225B4487DD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000225B3EDF230>, 189442.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000225B4613550>
INFO:aiogram.event:Update id=657781301 is handled. Duration 217 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781302 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781302 by bot id=7128547705
AttributeError: 'SuccessfulPayment' object has no attribute 'from_user_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 753, in __getattr__
    return pydantic_extra[item]
           ~~~~~~~~~~~~~~^^^^^^
KeyError: 'from_user_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 105, in process_successful_payment
    subscribe_id = message.successful_payment.from_user_id
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 755, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
AttributeError: 'SuccessfulPayment' object has no attribute 'from_user_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005469s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006565s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007407s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008275s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781303 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.146s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.028s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781304 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781305 is handled. Duration 483 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020A9DDD1390>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020A9D65AC80>, 189520.156)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020A9D669090>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781306 is handled. Duration 280 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020A9DE40DD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020A9D65A3C0>, 189534.218)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020A9DE5BFD0>
INFO:aiogram.event:Update id=657781307 is handled. Duration 217 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781308 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781308 by bot id=7128547705
AttributeError: 'SuccessfulPayment' object has no attribute 'from_user_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 753, in __getattr__
    return pydantic_extra[item]
           ~~~~~~~~~~~~~~^^^^^^
KeyError: 'from_user_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 106, in process_successful_payment
    subscribe_id = message.successful_payment.from_user_id
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 755, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
AttributeError: 'SuccessfulPayment' object has no attribute 'from_user_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00128s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006509s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007849s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00876s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01011s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781309 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.041s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.091s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781310 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781311 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000209C22EDB50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000209C1BE2D60>, 190301.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000209BE261990>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781312 is not handled. Duration 296 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781312 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 58, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await process_successful_payment(subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000209C1DD0410>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000209C1BE2F20>, 190315.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000209C1DD3950>
INFO:aiogram.event:Update id=657781313 is handled. Duration 235 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781314 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781314 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006435s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007656s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00869s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009666s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781315 is handled. Duration 656 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.736s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.219s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781316 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781317 is handled. Duration 360 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000012F86B41810>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000012F863C2CF0>, 190392.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000012F86B40BD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781318 is handled. Duration 358 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000012F863A3590>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000012F863C2F20>, 190406.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000012F863A16D0>
INFO:aiogram.event:Update id=657781319 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781320 is handled. Duration 0 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 250.1s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781321 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 251.3s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 252.8s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781322 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 249.8s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781323 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 249.6s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000012F86BDF690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000012F863C2270>, 190642.0)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000012F86BDDCD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781324 is handled. Duration 282 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000012F86BDC310>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000012F863C2C10>, 190654.484)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000012F86AD2A10>
INFO:aiogram.event:Update id=657781325 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781326 is handled. Duration 0 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 282.8s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781327 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 284s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 285.5s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781328 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 282.9s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781329 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 283s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000012F86BE2FD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000012F863C0590>, 190675.359)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000012F86BE08D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781330 is handled. Duration 328 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000012F86BDDA10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000012F863C2EB0>, 190693.843)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000012F86BDEAD0>
INFO:aiogram.event:Update id=657781331 is handled. Duration 217 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781332 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005361s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0064s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007995s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009777s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781333 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.402s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.735s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781334 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781335 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AE30D615D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AE3068AC80>, 190766.234)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AE30B49ED0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781336 is handled. Duration 282 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AE30B84050>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AE3068AEB0>, 190782.14)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AE30B84710>
INFO:aiogram.event:Update id=657781337 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781338 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005628s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006684s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007607s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008527s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781340 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.9338s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.243s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781341 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781342 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E7088A1D90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E7081A6C80>, 190954.953)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E708317810>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00147s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781343 is handled. Duration 264 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E708773B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E7081A63C0>, 190970.109)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E7088A2B50>
INFO:aiogram.event:Update id=657781344 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781345 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F898D5F2D0>
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006157s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007592s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008705s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009869s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781349 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.297s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.838s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781350 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781351 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021D99520150>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021D98ED6BA0>, 191139.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021D99600D90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.00531s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01377s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01514s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] (1, datetime.datetime(2024, 5, 13, 16, 6, 47, 710956), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781352 is handled. Duration 344 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021D99602C50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021D98ED6DD0>, 191152.406)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021D99602350>
INFO:aiogram.event:Update id=657781353 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781354 is handled. Duration 265 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005235s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006238s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007109s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00813s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781355 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.092s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.836s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781356 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781357 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002412190D310>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000241211FAC10>, 191463.125)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000241211D0A90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004992s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.2663s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] (datetime.datetime(2024, 5, 13, 16, 12, 11, 109730), 5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781358 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002412190E950>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000241211FA350>, 191475.64)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000024121838810>
INFO:aiogram.event:Update id=657781359 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781360 is handled. Duration 312 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005845s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007145s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008211s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009194s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0305s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03185s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03274s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03367s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03457s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00069s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00078s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00083s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00109s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00079s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781361 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781362 is handled. Duration 171 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781363 is handled. Duration 141 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781364 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 31.28s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781365 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 33.03s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781366 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ('', 3, 49.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781367 is handled. Duration 140 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781368 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.691s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 41.48s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781369 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781370 is handled. Duration 157 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781371 is not handled. Duration 233 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781371 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 9.766s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 49.55s ago] ()
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019A1BACFB60>, 191547.796)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019A1C0CFED0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781372 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 7.989s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781373 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 7.889s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781374 is not handled. Duration 233 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781374 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005547s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007045s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008089s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009089s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781375 is handled. Duration 0 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781376 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.29s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 9.126s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781377 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781378 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781379 is not handled. Duration 327 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781379 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
INFO:aiogram.event:Update id=657781380 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781381 is handled. Duration 0 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020CC6341210>
INFO:aiogram.event:Update id=657781382 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781383 is handled. Duration 110 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781384 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781385 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 109s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781386 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 111s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781387 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ('', 10, 99.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781388 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 118.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781389 is handled. Duration 141 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 109.5s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781390 is handled. Duration 405 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 117s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781391 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 118.1s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 125.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781392 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 117s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781393 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 118.8s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781394 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 118.1s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020CC648AE10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020CC6483BD0>, 191695.984)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020CC6488E90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.0064s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00125s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01434s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01588s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 118.4s ago] (2,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] (2, datetime.datetime(2024, 5, 13, 16, 16, 3, 976575), 10, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781395 is handled. Duration 281 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020CC649A010>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020CC5C7EEB0>, 191711.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020CC649B710>
INFO:aiogram.event:Update id=657781396 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781397 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 171.5s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781398 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 172.6s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 180.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781399 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 171.4s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781400 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 171.1s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781401 is not handled. Duration 280 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781401 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
INFO:aiogram.event:Update id=657781402 is handled. Duration 93 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781403 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 194.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781404 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 196.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781405 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 83.8s ago] ('', 3, 55.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781406 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 194.7s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781407 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 195.8s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 203.6s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781408 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 194.6s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781409 is handled. Duration 530 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 194.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781410 is not handled. Duration 328 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781410 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 197.3s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781411 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 198.7s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781412 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 197.8s ago] (3,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020CC634D2D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020CC661FD90>, 191772.171)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020CC63688D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781413 is not handled. Duration 250 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781413 by bot id=7128547705
TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 274, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2606, in send_invoice
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 179, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
INFO:aiogram.event:Update id=657781414 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 234s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781415 is handled. Duration 92 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 225.5s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781416 is handled. Duration 547 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:DELETE FROM subscribe WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] (3,)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781417 is handled. Duration 328 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020CC62C89D0>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:DELETE FROM subscribe WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.275s ago] (1,)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781418 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:DELETE FROM subscribe WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.373s ago] (2,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781419 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781419 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: UPDATE  DELETE   "subscribe"     "user_current_subscription_id_fkey"  "user"
DETAIL:    (id)=(2)       "user".
[SQL: DELETE FROM subscribe WHERE subscribe.id = $1::INTEGER]
[parameters: (2,)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: UPDATE  DELETE   "subscribe"     "user_current_subscription_id_fkey"  "user"
DETAIL:    (id)=(2)       "user".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: UPDATE  DELETE   "subscribe"     "user_current_subscription_id_fkey"  "user"
DETAIL:    (id)=(2)       "user".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\admin_private.py", line 75, in delete_subscribe
    await orm_delete_subscribe(session, int(subscribe_id))
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 162, in orm_delete_subscribe
    await session.execute(query)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 1946, in orm_execute_statement
    return super().orm_execute_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: UPDATE  DELETE   "subscribe"     "user_current_subscription_id_fkey"  "user"
DETAIL:    (id)=(2)       "user".
[SQL: DELETE FROM subscribe WHERE subscribe.id = $1::INTEGER]
[parameters: (2,)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:aiogram.event:Update id=657781420 is handled. Duration 109 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781421 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 251.5s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781422 is handled. Duration 139 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 253.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781423 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 143.2s ago] ('', 3, 88.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781424 is handled. Duration 157 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 255.7s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781425 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 256.6s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 264.5s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781426 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 255.3s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781427 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 258.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781428 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 257.5s ago] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020CC6707A50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020CC67264A0>, 191835.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020CC6707810>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 139.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 139.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 257.8s ago] (4,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 139.4s ago] (4, datetime.datetime(2024, 5, 13, 16, 18, 23, 393306), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781429 is handled. Duration 266 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006284s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007391s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008335s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01051s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781430 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.037s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.281s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781431 is handled. Duration 391 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781432 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002BEE1AED250>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002BEE13BAC80>, 191920.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002BEE13D0350>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005956s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3182s ago] (2,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] (2, datetime.datetime(2024, 5, 13, 16, 19, 48, 173245), 10, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781433 is handled. Duration 327 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005912s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006946s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0079s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008782s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781434 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.23s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.679s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781435 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781436 is handled. Duration 407 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.908s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781437 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AF23882350>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AF231A6E40>, 192414.296)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AF23105990>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781438 is handled. Duration 328 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AF23880350>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AF231A7000>, 192428.656)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AF23882D90>
INFO:aiogram.event:Update id=657781439 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005388s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('month_sub',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781440 is not handled. Duration 15 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781440 by bot id=7128547705
ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>:   : integer = character varying
HINT:          . ,      .
[SQL: SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::VARCHAR]
[parameters: ('month_sub',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 765, in _prepare
    prepared_stmt = await self._connection.prepare(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\connection.py", line 636, in prepare
    return await self._prepare(
           ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\connection.py", line 654, in _prepare
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedFunctionError:   : integer = character varying
HINT:          . ,      .

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>:   : integer = character varying
HINT:          . ,      .

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 113, in process_successful_payment
    await update_user_subscription(session, user_id, subscribe_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 293, in update_user_subscription
    subscribe = await orm_get_subscribe(session, subscribe_id)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 141, in orm_get_subscribe
    result = await session.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>:   : integer = character varying
HINT:          . ,      .
[SQL: SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::VARCHAR]
[parameters: ('month_sub',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00148s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01809s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02355s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02832s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03348s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00183s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781441 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.308s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.472s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781442 is handled. Duration 405 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781443 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.205s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781444 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AA96F00D90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AA9A88ADD0>, 192661.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AA9A8970D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781445 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AA9AED2A10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AA9A88ADD0>, 192674.156)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AA9A8970D0>
INFO:aiogram.event:Update id=657781446 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.006456s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('4',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781447 is not handled. Duration 15 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781447 by bot id=7128547705
ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>:   : integer = character varying
HINT:          . ,      .
[SQL: SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::VARCHAR]
[parameters: ('4',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 765, in _prepare
    prepared_stmt = await self._connection.prepare(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\connection.py", line 636, in prepare
    return await self._prepare(
           ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\connection.py", line 654, in _prepare
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedFunctionError:   : integer = character varying
HINT:          . ,      .

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>:   : integer = character varying
HINT:          . ,      .

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 115, in process_successful_payment
    await update_user_subscription(session, user_id, subscribe_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 294, in update_user_subscription
    subscribe = await orm_get_subscribe(session, subscribe_id)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 141, in orm_get_subscribe
    result = await session.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>:   : integer = character varying
HINT:          . ,      .
[SQL: SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::VARCHAR]
[parameters: ('4',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005683s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006627s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007616s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008523s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781448 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.093s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.792s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781449 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781450 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.345s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781451 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] (4,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781452 is not handled. Duration 14 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781452 by bot id=7128547705
TypeError: invoice() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
          ^^^^^^^^
TypeError: invoice() takes 4 positional arguments but 5 were given
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 9.92s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 10.62s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781453 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 8.713s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781454 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 8.197s ago] (2,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781455 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781455 by bot id=7128547705
TypeError: invoice() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
          ^^^^^^^^
TypeError: invoice() takes 4 positional arguments but 5 were given
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009854s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.011s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01201s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01309s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (2,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781456 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781456 by bot id=7128547705
TypeError: invoice() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
          ^^^^^^^^
TypeError: invoice() takes 4 positional arguments but 5 were given
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781457 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.221s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.538s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781458 is handled. Duration 327 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781459 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.828s ago] (2,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781460 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781460 by bot id=7128547705
TypeError: invoice() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    await invoice(
          ^^^^^^^^
TypeError: invoice() takes 4 positional arguments but 5 were given
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00075s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005246s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006518s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008787s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01064s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781461 is handled. Duration 264 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.04s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.82s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781462 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781463 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.392s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781464 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017E58A52590>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017E58362F90>, 192927.625)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017E58A43FD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781465 is not handled. Duration 250 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781465 by bot id=7128547705
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 91, in buy_subscription
    await process_successful_payment(subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017E58342DD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017E58363070>, 192939.937)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017E58A513D0>
INFO:aiogram.event:Update id=657781466 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781467 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781467 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006266s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007437s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008431s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009416s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781468 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.341s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.329s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781469 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781470 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.058s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781471 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (4,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781472 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781472 by bot id=7128547705
TypeError: invoice() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 60, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 88, in buy_subscription
    await invoice(
          ^^^^^^^^
TypeError: invoice() missing 1 required positional argument: 'subscribe_id'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 9.979s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 10.97s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781473 is handled. Duration 282 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00123s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0065s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009871s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01108s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01216s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781474 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.245s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.936s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781475 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781476 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.511s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781477 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (4,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781478 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781478 by bot id=7128547705
TypeError: invoice() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
          ^^^^^^^^
TypeError: invoice() missing 1 required positional argument: 'subscribe_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005304s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00645s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009193s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01453s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00174s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781479 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.191s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.109s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781480 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781481 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.543s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781482 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019C85B8AFD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019C85B76EB0>, 194006.703)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019C85B8B150>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781483 is handled. Duration 358 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019C86274150>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019C85AFFC40>, 194038.0)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019C862740D0>
INFO:aiogram.event:Update id=657781484 is handled. Duration 282 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781485 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781485 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008351s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00944s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01034s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01121s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781486 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.016s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.434s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781487 is handled. Duration 391 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781488 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.214s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781489 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F776E92990>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001F77A812E40>, 194129.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001F77A820AD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781490 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F77AF20890>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001F77A813000>, 194140.89)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001F77AEB3350>
INFO:aiogram.event:Update id=657781491 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781492 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781492 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004928s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005938s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00685s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007768s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781493 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.14s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.542s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781494 is handled. Duration 406 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00119s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781495 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.581s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781496 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000232E9F3EB10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000232E97C2E40>, 194215.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000232E97E0350>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781497 is handled. Duration 282 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000232E5E40B90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000232E974BBD0>, 194234.437)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000232E5E409D0>
INFO:aiogram.event:Update id=657781498 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781499 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781499 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'subscribe_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006529s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007836s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008842s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009783s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781500 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.627s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.794s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781501 is handled. Duration 516 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781502 is handled. Duration 437 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.362s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781503 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] (4,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002AD4E5D88D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002AD4E03AE40>, 194566.843)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002AD4E221BD0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781504 is not handled. Duration 266 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781504 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 97, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002AD4E814CD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002AD4E03AF20>, 194578.109)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002AD4E814B50>
INFO:aiogram.event:Update id=657781505 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781506 is handled. Duration 109 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00116s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01163s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01407s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01677s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01976s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00071s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00080s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00069s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00061s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00067s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.06815s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.07216s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.07348s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.07476s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.07578s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00102s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00103s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00323s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00121s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00079s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00017s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781507 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781508 is handled. Duration 297 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781509 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781510 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 23.05s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781511 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 25.09s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781512 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] (' ', 5, 99.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781513 is handled. Duration 92 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781514 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.107s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 32.41s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781515 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781516 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019615BA3A90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000196155BBB60>, 194659.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019612074F50>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00125s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.008047s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01665s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781517 is not handled. Duration 312 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781517 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 97, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019615BA16D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001961553BC40>, 194686.375)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019615BA0990>
INFO:aiogram.event:Update id=657781518 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781519 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004903s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005903s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006773s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007615s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00020s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00035s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00040s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03264s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03431s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03511s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03586s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03668s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00082s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00076s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00095s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00111s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00079s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781520 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781521 is handled. Duration 157 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781522 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781523 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 21.01s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781524 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 22.92s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781525 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('', 5, 149.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781526 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781527 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.998s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 32.58s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781528 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781529 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001ACD8ACDB50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001ACD894BAF0>, 195085.437)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001ACD8FC1BD0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00116s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004872s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01367s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781530 is not handled. Duration 266 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781530 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 97, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001ACD8ACFBD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001ACD88CFC40>, 195117.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001ACD8ACF390>
INFO:aiogram.event:Update id=657781531 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781532 is handled. Duration 280 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006754s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007743s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008646s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009506s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02939s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03081s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03165s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03253s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03337s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00070s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00075s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00149s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00108s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00077s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781533 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781534 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781535 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781536 is handled. Duration 187 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781537 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 258.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781538 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 261.7s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781539 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('', 4, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781540 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781541 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.175s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 270.7s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781542 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781543 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C82118A910>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C820C8B930>, 195990.703)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C821200050>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00188s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.006254s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00133s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01481s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781544 is not handled. Duration 264 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781544 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 97, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C8212008D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C820C0FC40>, 196027.218)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C8212011D0>
INFO:aiogram.event:Update id=657781545 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781546 is handled. Duration 219 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006138s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007396s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008383s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00929s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00037s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03331s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03499s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03584s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03663s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03751s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00067s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00076s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00108s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00125s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00073s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781548 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781549 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781550 is handled. Duration 157 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781551 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 15.45s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781552 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 17.12s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781553 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ('', 4, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781554 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781555 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.225s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 34.43s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781556 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781557 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021171FD3D50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021171967A80>, 196174.015)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021171FD3CD0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00118s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005434s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01229s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781558 is not handled. Duration 250 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781558 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 60, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 98, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021172093210>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000211718EBBD0>, 196191.562)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021172093510>
INFO:aiogram.event:Update id=657781559 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781560 is handled. Duration 312 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004866s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005918s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006977s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008216s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781561 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.102s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.29s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781562 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781563 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021CF0951390>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021CF027ABA0>, 196257.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021CF0950710>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781564 is not handled. Duration 282 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781564 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 60, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 98, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021CF09EFC10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021CF027ADD0>, 196268.734)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021CF09EFA90>
INFO:aiogram.event:Update id=657781565 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781566 is handled. Duration 141 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005823s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006842s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007737s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0086s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781567 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.424s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.703s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781568 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781569 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E745B01610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E745412B30>, 196398.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E74540F410>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781570 is not handled. Duration 296 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781570 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 97, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E745B9FF50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E745412D60>, 196414.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E745B9FD10>
INFO:aiogram.event:Update id=657781571 is handled. Duration 358 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781572 is handled. Duration 250 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006947s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008558s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009566s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01043s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781573 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.079s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.246s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781574 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781575 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E123F20910>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E1278A6B30>, 196513.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E12437F6D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781576 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E127D425D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E1278A6200>, 196539.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E127D53FD0>
INFO:aiogram.event:Update id=657781577 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781578 is handled. Duration 250 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006798s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007916s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009626s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01275s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781579 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.322s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.243s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781580 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781581 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002228C0B1890>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002228B9CAB30>, 196615.75)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002228B9C3690>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004751s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.2961s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] (1, datetime.datetime(2024, 5, 13, 17, 38, 3, 740084), 4, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657781582 is handled. Duration 312 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007999s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009392s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01079s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01183s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781583 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781584 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781585 is handled. Duration 187 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781586 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781587 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 25.35s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781588 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 27.38s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781589 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ('', 3, 124.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781590 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781591 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.075s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 36.92s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781592 is handled. Duration 358 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781593 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.889s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781594 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020D3DA5EA90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020D3D2EB770>, 196886.281)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020D3DA52E90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.00543s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.2537s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] (2, datetime.datetime(2024, 5, 13, 17, 42, 34, 253118), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657781595 is handled. Duration 265 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006302s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00749s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008642s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009646s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781596 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.364s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.029s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781597 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781598 is handled. Duration 687 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EE58E51B10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EE586F6BA0>, 196973.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EE58E515D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781599 is handled. Duration 282 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EE58E52590>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EE586F62E0>, 196987.218)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EE58E53290>
INFO:aiogram.event:Update id=657781600 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781601 is handled. Duration 217 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005408s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008621s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01019s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01133s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00119s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781602 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.159s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.697s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781603 is handled. Duration 516 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781604 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000027CE6CC1D50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000027CE65CAC80>, 197253.937)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000027CE6CC1110>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781605 is handled. Duration 297 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781606 is not handled. Duration 219 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781606 by bot id=7128547705
AttributeError: 'PreCheckoutQuery' object has no attribute 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 753, in __getattr__
    return pydantic_extra[item]
           ~~~~~~~~~~~~~~^^^^^^
KeyError: 'message'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 119, in process_pre_checkout_query
    success = await process_successful_payment(pre_checkout_query.message)
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 755, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
AttributeError: 'PreCheckoutQuery' object has no attribute 'message'
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000027CE65CAEB0>, 197268.5)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000027CE6CC3350>
INFO:aiogram.event:Update id=657781607 is handled. Duration 218 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004769s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005716s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006596s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007502s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781608 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.395s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.973s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781609 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781610 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B502CCC050>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B5061C6BA0>, 197329.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B5061A2F90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781611 is handled. Duration 264 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B5061D2B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B5061C6DD0>, 197343.015)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B5061D0890>
INFO:aiogram.event:Update id=657781612 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781613 is handled. Duration 233 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00187s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0129s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0189s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0217s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02358s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00239s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781614 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.354s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.455s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781615 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781616 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000219157A18D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021915046C10>, 197769.968)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002191557DA90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004684s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.2604s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (1, datetime.datetime(2024, 5, 13, 17, 57, 17, 959623), 4, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657781617 is handled. Duration 358 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000219157A22D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021914FCBC40>, 197805.453)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021911B1C050>
INFO:aiogram.event:Update id=657781618 is handled. Duration 469 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781619 is handled. Duration 219 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007489s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00844s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009288s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01021s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00033s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781620 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.147s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.115s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781621 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781622 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00115s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D5177C8050>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D51B176C10>, 197867.156)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D51B8B12D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] (334570076,)
ERROR:root:   : 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781623 is not handled. Duration 312 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781623 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    success = await process_successful_payment(callback.message)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 121, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 12.84s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 15.81s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781624 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 12.86s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781625 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 13.91s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781626 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 13.62s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D51B992090>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D51B9849F0>, 197880.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D51B8B1990>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 13.55s ago] (334570076,)
ERROR:root:   : 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781627 is not handled. Duration 250 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781627 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    success = await process_successful_payment(callback.message)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 121, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D51B94BAD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D51B0FBC40>, 197917.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D51B98D150>
INFO:aiogram.event:Update id=657781628 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781629 is handled. Duration 217 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006026s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00708s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008019s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008863s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781630 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.083s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.129s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781631 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781632 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00118s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002ED5C041CD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002ED5B95AC10>, 198259.625)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002ED5B930B10>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00116s] (334570076,)
ERROR:root:   : 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781633 is not handled. Duration 297 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781633 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    success = await process_successful_payment(callback.message)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 121, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002ED5C11C450>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002ED5B95AE40>, 198275.015)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002ED5C11C310>
INFO:aiogram.event:Update id=657781634 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781635 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 45.28s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781636 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 46.51s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 49.55s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781637 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 45.31s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781638 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.63s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781639 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 46.98s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002ED5C066350>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002ED5B959A20>, 198306.593)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002ED5C066790>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 46.96s ago] (334570076,)
ERROR:root:   : 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781640 is not handled. Duration 264 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781640 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    success = await process_successful_payment(callback.message)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 121, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002ED5C064210>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002ED5B95A270>, 198318.046)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002ED5C0644D0>
INFO:aiogram.event:Update id=657781641 is handled. Duration 217 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781642 is handled. Duration 92 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00728s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00836s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009304s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01026s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781643 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.423s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.606s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781644 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781645 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.738s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781646 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000280652F1ED0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000028064B7AD60>, 198380.671)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000028064B50AD0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (334570076,)
ERROR:root:   : 'NoneType' object is not iterable
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781647 is not handled. Duration 281 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781647 by bot id=7128547705
TypeError: 'NoneType' object is not iterable
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    success = await process_successful_payment(callback.message)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 121, in process_successful_payment
    for j,k in message.successful_payment:
TypeError: 'NoneType' object is not iterable
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000280653C4ED0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000028064B7AF20>, 198395.906)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000280653C4D50>
INFO:aiogram.event:Update id=657781648 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781649 is handled. Duration 219 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005333s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006437s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007439s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008299s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781650 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.245s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.772s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781651 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781652 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.683s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781653 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001911DC92DD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001911D5C6DD0>, 198514.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001911DC7FB50>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] (334570076,)
ERROR:root:   : 'NoneType' object has no attribute 'currency'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781654 is not handled. Duration 266 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781654 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'currency'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    success = await process_successful_payment(callback.message)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 121, in process_successful_payment
    if message.successful_payment.currency == "RUB":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'currency'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001911DD651D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001911D5C6F90>, 198526.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001911DD65050>
INFO:aiogram.event:Update id=657781655 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781656 is handled. Duration 218 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00146s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01446s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0171s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01958s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02313s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781657 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.294s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.067s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781658 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781659 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.913s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781660 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00115s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000143C05729D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000143BFE6ADD0>, 198573.89)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000143BFFDF910>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781661 is handled. Duration 250 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000143C055E650>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000143BFE6AF90>, 198587.375)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000143C055EBD0>
INFO:aiogram.event:Update id=657781662 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781663 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00119s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006854s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007887s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008775s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009644s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781664 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.101s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.862s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781665 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781666 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.256s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781667 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019A7C8E2A90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019A7C186D60>, 198714.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019A78C4C050>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] (334570076,)
ERROR:root:   : 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781668 is not handled. Duration 296 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781668 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    success = await process_successful_payment(callback.message)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 121, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_sub":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019A7C8CFF90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019A7C10BBD0>, 198740.546)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019A7C8CEED0>
INFO:aiogram.event:Update id=657781669 is handled. Duration 217 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781670 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006758s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007758s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008643s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009499s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006385s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007476s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008361s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009201s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00033s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781671 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.334s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 8.401s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781672 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781673 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 3.072s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781674 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001923D5DE610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001923CF06EB0>, 203544.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001923D5D36D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781675 is handled. Duration 437 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001923D5D27D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001923CF06F90>, 203559.734)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001923D4541D0>
INFO:aiogram.event:Update id=657781676 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781677 is not handled. Duration 233 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781677 by bot id=7128547705
AttributeError: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 116, in process_successful_payment
    subscribe_id = message.successful_payment.invoice_payload.get("subscribe_id")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005093s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00605s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006917s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007746s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781678 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.544s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.941s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781679 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781680 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.332s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781681 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (2,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781682 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781682 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 101, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006274s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007344s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008916s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01056s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781683 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.518s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 8.364s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781684 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781685 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] (1,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781686 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781686 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 101, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.806s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781687 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.997s ago] (2,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781688 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781688 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 101, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00577s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006871s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007857s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00871s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781690 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.14s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.481s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781691 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781692 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.421s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781693 is handled. Duration 155 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00112s] (2,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781694 is not handled. Duration 94 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781694 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.948s ago] (2,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781695 is not handled. Duration 125 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781695 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.873s ago] (2,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781696 is not handled. Duration 109 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781696 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 8.392s ago] (2,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781697 is not handled. Duration 125 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781697 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 10.87s ago] (2,)
ERROR:root:   : 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781698 is not handled. Duration 140 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781698 by bot id=7128547705
ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 90, in buy_subscription
    await invoice(
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 279, in invoice
    await bot.send_invoice(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 2575, in send_invoice
    call = SendInvoice(
           ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\pydantic\main.py", line 164, in __init__
    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendInvoice
payload
  Input should be a valid string [type=string_type, input_value={'subscribe_id': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/string_type
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006035s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009622s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01166s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01307s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781699 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.474s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.708s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781700 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781701 is handled. Duration 437 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.655s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781702 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CDF30ABF10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001CDF30BAE40>, 204489.281)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001CDF36076D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (334570076,)
ERROR:root:   : process_successful_payment() missing 1 required positional argument: 'message'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781703 is not handled. Duration 265 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781703 by bot id=7128547705
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 112, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 98, in buy_subscription
    success = await process_successful_payment()
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 1 required positional argument: 'message'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CDF3861350>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001CDF30BB000>, 204504.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001CDF38611D0>
INFO:aiogram.event:Update id=657781704 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781705 is handled. Duration 281 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006878s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008081s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009053s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01014s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00033s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781706 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.316s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.746s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781707 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781708 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.607s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781709 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00118s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AABD7F26D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AABD13AE40>, 204753.781)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AABD7F2250>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781710 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AABD7DEA90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AABD13B000>, 204768.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AABD7DE810>
INFO:aiogram.event:Update id=657781711 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781712 is handled. Duration 233 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00130s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005711s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007127s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008062s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008895s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005291s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006412s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007408s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008295s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00123s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781713 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.299s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.36s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781714 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781715 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.813s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781716 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002659B202690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002659B1FEE40>, 204905.125)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002659B942750>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781717 is handled. Duration 312 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002659B92F750>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002659B1FF000>, 204919.843)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002659B39F710>
INFO:aiogram.event:Update id=657781718 is handled. Duration 217 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781719 is handled. Duration 233 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007066s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009022s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01027s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01124s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00130s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781720 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.275s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.512s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781721 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781722 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.7241s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781723 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000023FC3DB3390>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000023FC36AEE40>, 205281.765)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000023FC23DDA10>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00148s] (334570076,)
ERROR:root:   : cannot access local variable 'process_successful_payment' where it is not associated with a value
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781724 is not handled. Duration 265 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781724 by bot id=7128547705
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    process_successful_payment = await process_successful_payment()
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000023FC3E75690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000023FC36AF000>, 205294.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000023FC3E75510>
INFO:aiogram.event:Update id=657781725 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781726 is handled. Duration 217 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008746s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01045s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01336s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01623s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781727 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.034s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.434s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781728 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781729 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.365s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781730 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002E908EF2F50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002E9087B6E40>, 205405.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002E908EF2A10>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00130s] (334570076,)
ERROR:root:   : cannot access local variable 'process_successful_payment' where it is not associated with a value
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781731 is not handled. Duration 328 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781731 by bot id=7128547705
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    process_successful_payment = await process_successful_payment(callback.message)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002E908FC1210>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002E9087B7000>, 205417.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002E908FC1090>
INFO:aiogram.event:Update id=657781732 is handled. Duration 203 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781733 is handled. Duration 250 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00128s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00715s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008191s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009153s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01006s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781734 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.027s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.124s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781735 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00112s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781736 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.132s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781737 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D17F421910>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D17F442F90>, 205452.343)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D17F450350>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] (334570076,)
ERROR:root:   : cannot access local variable 'process_successful_payment' where it is not associated with a value
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781738 is not handled. Duration 250 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781738 by bot id=7128547705
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 100, in buy_subscription
    process_successful_payment = await process_successful_payment(callback)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D17FBF89D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D17F443070>, 205468.296)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D17FBF8890>
INFO:aiogram.event:Update id=657781739 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781740 is handled. Duration 312 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005108s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006726s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008663s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009694s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781741 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.547s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 8.695s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781742 is handled. Duration 562 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781743 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.245s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781744 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002310E1E2110>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002310DADEDD0>, 205731.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000023108FA9450>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00075s] (334570076,)
ERROR:root:   : cannot access local variable 'process_successful_payment' where it is not associated with a value
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781745 is not handled. Duration 282 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781745 by bot id=7128547705
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 59, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in buy_subscription
    raise e
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 99, in buy_subscription
    process_successful_payment = await process_successful_payment(callback)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'process_successful_payment' where it is not associated with a value
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002310E2B4D10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002310DADEF90>, 205748.703)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002310DC2A6D0>
INFO:aiogram.event:Update id=657781746 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781747 is handled. Duration 250 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005967s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008085s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009169s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01016s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781748 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.002s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.248s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781749 is handled. Duration 360 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781750 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.512s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781751 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CFA5AA2750>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001CFA53BAD60>, 206185.281)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001CFA5390B10>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781752 is handled. Duration 437 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CFA5528B10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001CFA5337BD0>, 206244.812)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001CFA5590810>
INFO:aiogram.event:Update id=657781753 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781754 is handled. Duration 218 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005341s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006417s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007667s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009229s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006574s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007818s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01002s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01161s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781755 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.279s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.813s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781756 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781757 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.586s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781758 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (2,)
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01625s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] (2, datetime.datetime(2024, 5, 13, 20, 21, 45, 84266), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020317D55790>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002031777B0E0>, 206437.39)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020317E9D6D0>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3058s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781759 is handled. Duration 407 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008151s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009106s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01004s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01088s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781760 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.239s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.344s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781761 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781762 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.243s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781763 is handled. Duration 406 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (2,)
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00125s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01192s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] (datetime.datetime(2024, 5, 13, 20, 28, 12, 823648), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EB7F80D450>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EB7F35B1C0>, 206825.093)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EB7CDF5710>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3471s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3497s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781764 is not handled. Duration 360 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781764 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:13.164428).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:13.164428).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:13.164428).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 105, in buy_subscription
    await rollback_user_subscription(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 342, in rollback_user_subscription
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:13.164428).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 24.99s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781765 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 26.21s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 28.31s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781766 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 24.74s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781767 is handled. Duration 641 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.63s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781768 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 27.57s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781769 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 25.09s ago] (1,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 25.09s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 25.09s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 24.74s ago] (1, datetime.datetime(2024, 5, 13, 20, 28, 37, 906824), 4, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EB7F8927D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EB7FA5C1A0>, 206850.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EB7F092590>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 25.43s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 25.43s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 25.08s ago] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781770 is not handled. Duration 343 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781770 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:38.244966).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:38.244966).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:38.244966).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 105, in buy_subscription
    await rollback_user_subscription(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 342, in rollback_user_subscription
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 17:30:41.745335, mimimichaello, null, null, null, 0, null, 2024-04-13 17:30:41.745335, 2024-04-13 20:28:38.244966).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EB7FD1C0D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EB7F2D7CB0>, 206863.937)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EB7FD07FD0>
INFO:aiogram.event:Update id=657781771 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 41.49s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (datetime.datetime(2024, 4, 13, 20, 28, 54, 309399), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781772 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 166.9s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781773 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781774 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 170.2s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781775 is not handled. Duration 15 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781775 by bot id=7128547705
MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 142, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 159, in send_link
    subscription = user.current_subscription
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1068, in _emit_lazyload
    return loading.load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2360, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 122, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:aiogram.event:Update id=657781776 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 195.2s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 25.01s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781777 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781777 by bot id=7128547705
MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 142, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 159, in send_link
    subscription = user.current_subscription
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1068, in _emit_lazyload
    return loading.load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2360, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 122, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:aiogram.event:Update id=657781778 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 205.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 35.75s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781779 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781779 by bot id=7128547705
MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 142, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 159, in send_link
    subscription = user.current_subscription
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1068, in _emit_lazyload
    return loading.load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2360, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 122, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:aiogram.event:Update id=657781780 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 223.8s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 53.62s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781781 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781781 by bot id=7128547705
MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 142, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 159, in send_link
    subscription = user.current_subscription
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1068, in _emit_lazyload
    return loading.load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2360, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 122, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00885s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009925s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01107s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01191s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781782 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781783 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
ERROR:root:Error occurred: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781784 is handled. Duration 109 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005697s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008524s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01035s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01175s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781785 is handled. Duration 328 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781786 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] (1,)
ERROR:root:    : greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781787 is handled. Duration 203 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007166s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008713s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009974s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01091s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781788 is handled. Duration 297 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781789 is handled. Duration 546 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] (1,)
ERROR:root:    : greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781790 is handled. Duration 125 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005656s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006631s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007476s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008309s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005388s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007643s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0087s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009586s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781791 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781792 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00137s] (1,)
ERROR:root:    : greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781793 is handled. Duration 108 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005352s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006486s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007494s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008498s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781794 is handled. Duration 264 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781795 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id AS subscribe_id, subscribe.name AS subscribe_name, subscribe.description AS subscribe_description, subscribe.price AS subscribe_price, subscribe.category_id AS subscribe_category_id, subscribe.created AS subscribe_created, subscribe.updated AS subscribe_updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (1,)
ERROR:root:    : greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781796 is handled. Duration 108 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007897s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009132s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01012s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.011s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00112s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781797 is handled. Duration 405 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781798 is handled. Duration 390 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] (1,)
ERROR:root:    : get_links_sent_count() takes 3 positional arguments but 4 were given
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781799 is handled. Duration 108 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008338s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01151s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01375s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01536s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('main',)
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.376s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781801 is handled. Duration 437 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781802 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 13, 485545))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001969145DAD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019690E12F90>, 208445.937)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001969145CF10>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] (datetime.datetime(2024, 4, 13, 20, 55, 13, 914992), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 0.4365s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 13, 921991))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.4443s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.4458s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781803 is handled. Duration 592 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781800 is not handled. Duration 21015 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781800 by bot id=7128547705
TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [  ]
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 992, in _wrap_create_connection
    return await self._loop.create_connection(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1073, in create_connection
    raise exceptions[0]
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1058, in create_connection
    sock = await self._connect_sock(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 964, in _connect_sock
    await self.sock_connect(sock, address)
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\proactor_events.py", line 722, in sock_connect
    return await self._proactor.connect(sock, address)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 837, in _poll
    value = callback(transferred, key, ov)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 624, in finish_connect
    ov.getresult()
OSError: [WinError 121]   

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 171, in make_request
    async with session.post(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\client.py", line 1194, in __aenter__
    self._resp = await self._coro
                 ^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\client.py", line 578, in _request
    conn = await self._connector.connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 544, in connect
    proto = await self._create_connection(req, traces, timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 911, in _create_connection
    _, proto = await self._create_direct_connection(req, traces, timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 1235, in _create_direct_connection
    raise last_exc
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 1204, in _create_direct_connection
    transp, proto = await self._wrap_create_connection(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 1000, in _wrap_create_connection
    raise client_error(req.connection_key, exc) from exc
aiohttp.client_exceptions.ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [  ]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 53, in start_cmd
    await message.answer(text, reply_markup=reply_markup)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 178, in make_request
    raise TelegramNetworkError(method=method, message=f"{type(e).__name__}: {e}")
aiogram.exceptions.TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [  ]
INFO:aiogram.event:Update id=657781804 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 29.93s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 29.92s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 43, 410056))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000196913E0450>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019690E134D0>, 208475.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001968D491510>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 29.77s ago] (datetime.datetime(2024, 4, 13, 20, 55, 43, 680709), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 30.2s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 43, 684675))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 30.21s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 30.21s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 29.77s ago] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781805 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781806 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 36.26s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 36.25s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 49, 740525))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000196913A3F10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000196915430E0>, 208482.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019691603E50>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 36.09s ago] (datetime.datetime(2024, 4, 13, 20, 55, 50, 180), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 36.52s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 50, 4132))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 36.53s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 36.53s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 36.08s ago] (3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781807 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781808 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 41.72s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 41.72s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 55, 203234))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001969163F490>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000196915434D0>, 208487.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001969163F690>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 41.64s ago] (datetime.datetime(2024, 4, 13, 20, 55, 55, 557276), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 42.07s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 55, 55, 560222))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 42.08s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 42.08s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 41.64s ago] (4, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781809 is handled. Duration 469 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781810 is handled. Duration 407 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 48s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 48s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 56, 1, 484825))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000196915A04D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019691543930>, 208493.843)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000196915A19D0>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.89s ago] (datetime.datetime(2024, 4, 13, 20, 56, 1, 809739), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 48.33s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 56, 1, 812739))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 48.33s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 48.34s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.89s ago] (5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781811 is handled. Duration 452 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781812 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 55.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 55.4s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 56, 8, 881608))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001969163E2D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000196915435B0>, 208501.25)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019691583910>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 55.3s ago] (datetime.datetime(2024, 4, 13, 20, 56, 9, 216843), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 55.73s ago] (334570076, datetime.datetime(2024, 4, 12, 20, 56, 9, 219831))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 55.74s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 55.74s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 55.3s ago] (6, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781813 is handled. Duration 500 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005659s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006644s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007808s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01066s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781814 is handled. Duration 297 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781815 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (334570076, datetime.datetime(2024, 4, 12, 21, 0, 55, 294513))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000027BDBF7E310>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000027BDB7E2970>, 208787.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000027BDB7F5450>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] (datetime.datetime(2024, 4, 13, 21, 0, 55, 652724), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 0.3628s ago] (334570076, datetime.datetime(2024, 4, 12, 21, 0, 55, 657283))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3691s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3705s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] (7, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781816 is handled. Duration 546 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006539s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01025s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01222s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01334s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004841s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005798s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006807s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00769s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00066s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02994s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03203s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03299s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03381s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03497s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00068s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00072s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00222s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00159s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00015s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781817 is handled. Duration 264 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781818 is handled. Duration 546 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781819 is handled. Duration 140 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781820 is handled. Duration 140 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781821 is handled. Duration 139 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 38.45s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781822 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 40.33s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781823 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('', 3, 88.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781824 is handled. Duration 140 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 37.26s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781825 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 38.54s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 47.18s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781826 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781827 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] (1,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.008505s ago] (1,)
WARNING:root:User 334570076 not found
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B0B88FBFD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B0B81C3E00>, 208937.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B0B88F9090>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3895s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3917s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781828 is handled. Duration 391 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B0B8909810>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B0B81C2510>, 208954.781)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B0B8909DD0>
INFO:aiogram.event:Update id=657781829 is handled. Duration 562 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 19.83s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781830 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 88.39s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781831 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 89.78s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 98.42s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781832 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 51.17s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781833 is handled. Duration 391 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.31s ago] (1,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.31s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.31s ago] (1,)
WARNING:root:User 334570076 not found
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B0B898F6D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B0B81C3A80>, 208984.875)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B0B87988D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.64s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.65s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781834 is handled. Duration 342 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B0B8910590>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B0B81C2890>, 209008.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B0B89B8F10>
INFO:aiogram.event:Update id=657781835 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 74.17s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781836 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781837 is handled. Duration 391 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781838 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781839 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 231.1s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781840 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 233.1s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781841 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 194.7s ago] ('', 5, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781842 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 233.4s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781843 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 236.9s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 245.5s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781844 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 198.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781845 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 199.1s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781846 is handled. Duration 327 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 195.5s ago] (2,)
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 195.5s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 195.5s ago] (2,)
WARNING:root:User 334570076 not found
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B0B8A038D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B0B8A18050>, 209133.14)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B0B8A036D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 195.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 195.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781847 is handled. Duration 469 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B0B8A01F10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B0B81C2EB0>, 209154.265)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B0B8A02E90>
INFO:aiogram.event:Update id=657781848 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 219.1s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781849 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 521.5s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781850 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781851 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 484.8s ago] (334570076,)
ERROR:root:    : 'NoneType' object has no attribute 'username'
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781852 is handled. Duration 110 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006676s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007718s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008581s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009514s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781853 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.312s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.83s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781854 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781855 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781856 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781856 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 8.192s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 10.71s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781857 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 9.189s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781858 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 10.15s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 12.67s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781859 is handled. Duration 157 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 7.614s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781860 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 7.515s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781861 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781861 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005335s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006463s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007578s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008532s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781862 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.712s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 26.52s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781863 is handled. Duration 358 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781864 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781865 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781865 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.383s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781866 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.031s ago] (2,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781867 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781867 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006066s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007211s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008095s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008957s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00086s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00047s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03339s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03564s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0366s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03744s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03836s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00080s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00073s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00103s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00119s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00083s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00018s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781868 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781869 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781870 is handled. Duration 187 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781871 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 23.49s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781872 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 25.42s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781873 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ('', 3, 99.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781874 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781875 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.126s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 31.94s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781876 is handled. Duration 453 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00117s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781877 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781878 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781878 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1907s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781879 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781879 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00515s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006377s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007414s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008308s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781880 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.744s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 7.596s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781881 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781882 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781883 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781883 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006014s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00714s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008028s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008878s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781884 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.415s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.999s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781885 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781886 is handled. Duration 1078 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] (1,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.008962s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01525s ago] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01657s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.02233s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] (1, datetime.datetime(2024, 5, 13, 21, 57, 23, 143052), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000229B4527E50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000229B3FC2CF0>, 212175.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000229B44BAC90>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.4187s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.4211s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.4041s ago] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781887 is not handled. Duration 437 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781887 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 21:57:23.121773, mimimichaello, null, null, null, 0, null, 2024-04-13 21:57:23.121773, 2024-04-13 21:57:23.54404).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 21:57:23.121773, mimimichaello, null, null, null, 0, null, 2024-04-13 21:57:23.121773, 2024-04-13 21:57:23.54404).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 21:57:23.121773, mimimichaello, null, null, null, 0, null, 2024-04-13 21:57:23.121773, 2024-04-13 21:57:23.54404).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
    await rollback_user_subscription(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 342, in rollback_user_subscription
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 21:57:23.121773, mimimichaello, null, null, null, 0, null, 2024-04-13 21:57:23.121773, 2024-04-13 21:57:23.54404).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:aiogram.event:Update id=657781888 is not handled. Duration 21000 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781888 by bot id=7128547705
TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [  ]
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 992, in _wrap_create_connection
    return await self._loop.create_connection(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1073, in create_connection
    raise exceptions[0]
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1058, in create_connection
    sock = await self._connect_sock(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 964, in _connect_sock
    await self.sock_connect(sock, address)
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\proactor_events.py", line 722, in sock_connect
    return await self._proactor.connect(sock, address)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 837, in _poll
    value = callback(transferred, key, ov)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 624, in finish_connect
    ov.getresult()
OSError: [WinError 121]   

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 171, in make_request
    async with session.post(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\client.py", line 1194, in __aenter__
    self._resp = await self._coro
                 ^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\client.py", line 578, in _request
    conn = await self._connector.connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 544, in connect
    proto = await self._create_connection(req, traces, timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 911, in _create_connection
    _, proto = await self._create_direct_connection(req, traces, timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 1235, in _create_direct_connection
    raise last_exc
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 1204, in _create_direct_connection
    transp, proto = await self._wrap_create_connection(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiohttp\connector.py", line 1000, in _wrap_create_connection
    raise client_error(req.connection_key, exc) from exc
aiohttp.client_exceptions.ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [  ]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 114, in process_pre_checkout_query
    await pre_checkout(pre_checkout_query)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 289, in pre_checkout
    await bot.answer_pre_checkout_query(pre_checkout_query.id, ok=True)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 612, in answer_pre_checkout_query
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\bot.py", line 441, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 178, in make_request
    raise TelegramNetworkError(method=method, message=f"{type(e).__name__}: {e}")
aiogram.exceptions.TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [  ]
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000229B4953990>
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006103s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007299s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008458s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01092s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00035s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00046s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03802s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03958s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04098s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0441s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0458s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00432s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00169s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00237s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00246s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00159s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00019s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00014s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657781889 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781890 is handled. Duration 187 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781891 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781892 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 64.87s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781893 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 66.81s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781894 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ('', 3, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781895 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781896 is handled. Duration 157 ms by bot id=7128547705
INFO:aiogram.event:Update id=657781897 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 84.43s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781898 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 86.16s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781899 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 20.2s ago] ('', 5, 234.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781900 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781901 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.352s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 95.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781902 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781903 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00075s] (1,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004322s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00124s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01242s ago] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01384s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01741s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00028s] (1, datetime.datetime(2024, 5, 13, 22, 0, 46, 344711), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015EBCF19010>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000015EBD048590>, 212378.765)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015EBCF1EE10>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.5545s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.5573s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.5425s ago] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781904 is not handled. Duration 562 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781904 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:00:46.884739).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:00:46.884739).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:00:46.884739).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in buy_subscription
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 342, in rollback_user_subscription
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:00:46.884739).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 28.65s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781905 is handled. Duration 437 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005058s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006018s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007164s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008135s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781906 is handled. Duration 750 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.484s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.077s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781907 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781908 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (1,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EE1A22CD10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EE19D6AEB0>, 212511.984)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EE1A25D350>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3431s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.345s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781909 is not handled. Duration 360 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781909 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:02:59.69435).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:02:59.69435).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:02:59.69435).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 106, in buy_subscription
    await rollback_user_subscription(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 342, in rollback_user_subscription
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:02:59.69435).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 19.72s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781910 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 20.75s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 23.36s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781911 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 19.33s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781912 is handled. Duration 500 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 20.87s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781913 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 20.55s ago] (2,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 20.55s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EE1A216990>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EE1A6F7D90>, 212532.546)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EE1A216710>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 20.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 20.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 20.55s ago] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781914 is not handled. Duration 359 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781914 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:03:20.247223).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:03:20.247223).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:03:20.247223).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 106, in buy_subscription
    await rollback_user_subscription(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 342, in rollback_user_subscription
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-13 22:00:46.328207, mimimichaello, null, null, null, 0, null, 2024-04-13 22:00:46.328207, 2024-04-13 22:03:20.247223).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EE1A217ED0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EE19CFBC40>, 212562.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EE1A320810>
INFO:aiogram.event:Update id=657781915 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 54.56s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] (datetime.datetime(2024, 4, 13, 22, 3, 54, 258671), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781916 is handled. Duration 233 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006153s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007204s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008079s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009019s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781917 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.047s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 6.774s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781918 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781919 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.355s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781920 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026B913F2490>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026B90CE2EB0>, 212688.203)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026B8FA1D6D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781921 is handled. Duration 391 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026B90ED3E10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026B90C6BC40>, 212717.343)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026B90ED3D90>
INFO:aiogram.event:Update id=657781922 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 31.43s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (datetime.datetime(2024, 4, 13, 22, 6, 27, 706758), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781923 is handled. Duration 312 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005736s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006938s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008057s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009107s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781924 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.174s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.195s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781925 is handled. Duration 235 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781926 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.311s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781927 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (2,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781928 is not handled. Duration 14 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657781928 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 62, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 87, in buy_subscription
    user = await orm_get_user(session, user_id=user)
                                               ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006847s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008609s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01014s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01272s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781929 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.176s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.286s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781930 is handled. Duration 407 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781931 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.8206s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781932 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (2,)
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00123s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.013s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] (2, datetime.datetime(2024, 5, 13, 22, 9, 16, 600460), 5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EFE37DFCD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EFE30931C0>, 212888.89)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EFE37DF490>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3766s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781933 is handled. Duration 390 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004764s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005793s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006765s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007656s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781934 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.148s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 7.272s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781935 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00120s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781936 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 35.29s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781937 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000027E416E2AD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000027E40FC6C80>, 213256.515)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000027E40F25990>
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3554s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (datetime.datetime(2024, 5, 13, 22, 15, 24, 500616), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.1518s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781938 is handled. Duration 516 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 72.47s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781939 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 73.54s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 79.67s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781940 is handled. Duration 514 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 58.76s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781941 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 23.02s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000027E4177F110>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000027E40FC7540>, 213279.437)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000027E41787B50>
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 22.91s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 23.26s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00029s] (1, datetime.datetime(2024, 5, 13, 22, 15, 47, 408408), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 23.02s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781942 is handled. Duration 342 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005406s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006379s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007322s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008171s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781943 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.386s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 6.37s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781944 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781945 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.297s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781946 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019903DE3210>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001990369AE40>, 213388.593)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000199036AF390>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781947 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019903CE8B10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001990361BC40>, 213417.734)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001997EB6A350>
INFO:aiogram.event:Update id=657781948 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 31.41s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] (datetime.datetime(2024, 4, 13, 22, 18, 7, 981751), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781949 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 69.44s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781950 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 70.64s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 75.62s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781951 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 69.68s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781952 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 73.22s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781953 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 70.04s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019903E95950>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001990369AB30>, 213458.656)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019903E7F610>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 70.07s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781954 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019903E7F710>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001990369A580>, 213509.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019903E95C50>
INFO:aiogram.event:Update id=657781955 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 124s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 92.55s ago] (datetime.datetime(2024, 4, 13, 22, 19, 40, 530126), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781956 is handled. Duration 250 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01027s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01314s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01524s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0172s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781957 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.19s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.823s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781958 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781959 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.8354s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781960 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002072B782A10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002072B78AEB0>, 213562.812)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002072BF12B50>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781961 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002072BEFE390>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002072B78B070>, 213582.125)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002072BEFECD0>
INFO:aiogram.event:Update id=657781962 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 21.77s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] (datetime.datetime(2024, 4, 13, 22, 20, 52, 555592), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781963 is handled. Duration 389 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 66.01s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781964 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 67.36s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 67.99s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781965 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 66.07s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781966 is handled. Duration 155 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 68.09s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781967 is handled. Duration 406 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 67.01s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002072BFAFA90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002072B78A5F0>, 213629.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002072BFACCD0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 67.1s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781968 is handled. Duration 342 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002072BFB2090>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002072B788590>, 213648.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002072BFB0390>
INFO:aiogram.event:Update id=657781969 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 87.95s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 66.19s ago] (datetime.datetime(2024, 4, 13, 22, 21, 58, 742184), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781970 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006098s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007183s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008133s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009185s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781971 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.159s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.246s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781972 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781973 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.039s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781974 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001DAC22A2250>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001DAC1BC2EB0>, 213902.484)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001DAC1D95A10>
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3562s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] (2, datetime.datetime(2024, 5, 13, 22, 26, 10, 467586), 5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01229s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781975 is handled. Duration 375 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009647s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0112s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01265s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01385s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781976 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.017s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.97s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781977 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781978 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000281648C1C90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000281641C2D60>, 214050.406)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002815F68B150>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781979 is handled. Duration 483 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000281648C3290>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000281641C2E40>, 214082.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000281648C3550>
INFO:aiogram.event:Update id=657781980 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 34.05s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (datetime.datetime(2024, 4, 13, 22, 29, 12, 445917), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781981 is handled. Duration 250 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007306s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008432s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009334s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01022s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781982 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.144s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.588s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781983 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781984 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020737761210>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020737786E40>, 214369.765)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020737D80C90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781985 is handled. Duration 327 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020737E81610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002073770BCB0>, 214461.234)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020737E822D0>
INFO:aiogram.event:Update id=657781986 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 93.62s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] (datetime.datetime(2024, 4, 13, 22, 35, 31, 364000), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781987 is handled. Duration 280 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006307s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007318s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009696s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0128s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781988 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.11s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.688s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781989 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781990 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002BF5FFE0B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002BF5F8A6E40>, 214509.14)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002BF5F805990>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781991 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002BF5FFCC8D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002BF5F8A7070>, 214524.937)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002BF5FF70B90>
INFO:aiogram.event:Update id=657781992 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 18.97s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] (datetime.datetime(2024, 4, 13, 22, 36, 36, 87943), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781993 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006037s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007024s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007879s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008742s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781994 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 6.607s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 6.909s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781995 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781996 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000016179320650>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000016178C56E40>, 214666.906)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000016178C6A7D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657781997 is handled. Duration 250 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000161793226D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000016178C57070>, 214681.437)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000161752D27D0>
INFO:aiogram.event:Update id=657781998 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 16.67s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] (datetime.datetime(2024, 4, 13, 22, 39, 11, 556067), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657781999 is handled. Duration 233 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005645s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007023s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009092s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0111s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00174s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782001 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.9996s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.636s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782002 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782003 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.263s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782004 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.487s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782005 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (1,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01012s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] (1, datetime.datetime(2024, 5, 13, 22, 43, 17, 131732), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CC68A0C750>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001CC6851F8C0>, 214929.406)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001CC68B83DD0>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3458s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782006 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 35.36s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782007 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 37.3s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782008 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 38.26s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782009 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 39.06s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782010 is handled. Duration 93 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005197s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006224s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007126s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007999s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782011 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.08s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 6.776s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782012 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782013 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.74s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782014 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00121s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019D5F9A2B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019D5F2C2EB0>, 215125.625)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019D5F2D4050>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782015 is handled. Duration 391 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019D5F4B9310>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019D5F24BC40>, 215155.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019D5F4B2CD0>
INFO:aiogram.event:Update id=657782016 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] (datetime.datetime(2024, 4, 13, 22, 47, 5, 107574), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782017 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 51.58s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782018 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 52.54s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 58.23s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782019 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 52.31s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782020 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 53.08s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782021 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 51.51s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000019D5FA4F050>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000019D5F2C2CF0>, 215177.109)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000019D5FA4E550>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782022 is handled. Duration 344 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00575s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006756s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007563s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008401s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00116s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782023 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.201s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 6.511s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782024 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782025 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.426s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782026 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] (2,)
INFO:root:Sending invoice to user 334570076 for subscription 
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D7E8B32410>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D7E8436F20>, 215254.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D7E8B31950>
WARNING:root:Payment failed for user 334570076
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782027 is handled. Duration 389 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005568s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006709s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007709s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008736s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782028 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.134s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.331s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782029 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782030 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.027s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782031 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00128s] (2,)
INFO:root:Sending invoice to user 334570076 for subscription 
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026C7A212A50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026C79A73000>, 215362.89)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026C7A087810>
WARNING:root:Payment failed for user 334570076
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782032 is handled. Duration 342 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008562s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009704s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01064s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01158s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782033 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.425s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782034 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782035 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.512s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782036 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C0FB2F2D90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C0FABD6F20>, 215953.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C0FABDB190>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782037 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 152.7s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782038 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 154s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 154.5s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782039 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 152.4s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782040 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 154.1s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782041 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 152.8s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C0FB38F050>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C0FABD67B0>, 216106.703)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C0FB38F150>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782042 is handled. Duration 578 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008974s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01179s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01279s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01379s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782043 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.146s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.032s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782044 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782045 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.445s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782046 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00132s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017EE39C2650>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017EE32EAEB0>, 216261.593)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017EE38A1BD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782047 is handled. Duration 391 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017EE39C0E10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017EE32EB070>, 216276.328)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017EE39C1590>
INFO:aiogram.event:Update id=657782048 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] (datetime.datetime(2024, 4, 13, 23, 5, 46, 931728), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782049 is handled. Duration 233 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00129s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00833s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00941s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01054s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01177s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782050 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.9577s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.97s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782051 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782052 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.105s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782053 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C370AE2BD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C3703AEF90>, 216405.812)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C37052A190>
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00136s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.2648s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] (2, datetime.datetime(2024, 5, 13, 23, 7, 53, 796679), 5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657782054 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 211.2s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782055 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 212.2s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 213.2s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782056 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 211.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782057 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 210.3s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C370B93150>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C3703AE660>, 216616.109)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C370B913D0>
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 210.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 210.5s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 210.3s ago] (1, datetime.datetime(2024, 5, 13, 23, 11, 24, 77858), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657782058 is handled. Duration 312 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00124s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009557s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01438s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02057s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02279s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00186s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782059 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.093s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.305s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782060 is handled. Duration 407 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782061 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.8008s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782062 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000013C30222E10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000013C2FB3EEB0>, 216772.515)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000013C30222AD0>
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00125s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.429s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] (2, datetime.datetime(2024, 5, 13, 23, 14, 0, 635241), 5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657782063 is handled. Duration 578 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005137s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006146s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007041s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007941s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782064 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.345s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.296s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782065 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782066 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 3.951s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782067 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00121s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015AC6CE2C50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000015AC65FEEB0>, 217105.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015AC6CE2A50>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782068 is not handled. Duration 421 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782068 by bot id=7128547705
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 63, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 101, in buy_subscription
    await process_successful_payment(subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 54.36s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782069 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 55.54s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 58.49s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782070 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 53.85s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782071 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 50.19s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015AC6DB6910>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000015AC6D9BF50>, 217155.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015AC6DB4990>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782072 is not handled. Duration 546 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782072 by bot id=7128547705
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 63, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 101, in buy_subscription
    await process_successful_payment(subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015AC6CE1C50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000015AC658BCB0>, 217205.531)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015AC6AE7450>
INFO:aiogram.event:Update id=657782073 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00120s] (334570076, datetime.datetime(2024, 4, 12, 23, 21, 15, 521595))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015AC6DB4450>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000015AC65FE660>, 217207.906)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015AC6DB7E50>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (datetime.datetime(2024, 4, 13, 23, 21, 15, 888096), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 0.3716s ago] (334570076, datetime.datetime(2024, 4, 12, 23, 21, 15, 893597))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3836s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.385s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00028s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782074 is handled. Duration 703 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00661s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007883s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0099s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01157s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00141s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782075 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.509s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.071s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782076 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782077 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000238F51005D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000238F8B3ADD0>, 217279.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000238F5100D90>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782078 is not handled. Duration 344 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782078 by bot id=7128547705
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 63, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 101, in buy_subscription
    await process_successful_payment(subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_successful_payment() missing 2 required positional arguments: 'session' and 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000238F9286010>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000238F92D7E70>, 217293.359)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000238F9285050>
INFO:aiogram.event:Update id=657782079 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782080 is not handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782081 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id IS NULL
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ()
WARNING:root:Subscription None not found
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782082 is handled. Duration 15 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006324s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007528s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008485s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009397s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782083 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782084 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.9595s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 21.16s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782085 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782086 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.872s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782087 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C7B13F5B10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C7B0EAF0E0>, 219525.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C7B13F60D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782088 is not handled. Duration 391 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782088 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C7B13CCBD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C7B0EAC520>, 219558.046)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C7B13B2A10>
INFO:aiogram.event:Update id=657782089 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (334570076, datetime.datetime(2024, 4, 13, 0, 0, 28, 209021))
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C7B15DE850>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C7B0EAE660>, 219560.5)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C7B15DD850>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] (datetime.datetime(2024, 4, 14, 0, 0, 28, 484600), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 0.2804s ago] (334570076, datetime.datetime(2024, 4, 13, 0, 0, 28, 491600))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.294s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.2954s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00025s] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782090 is handled. Duration 531 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 99.24s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782091 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782092 is handled. Duration 155 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 79.63s ago] (6164336186,)
ERROR:root:    : (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 6164336186 (value out of int32 range)
[SQL: SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER]
[parameters: (6164336186,)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782093 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 83.99s ago] (6164336186,)
ERROR:root:    : (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 6164336186 (value out of int32 range)
[SQL: SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER]
[parameters: (6164336186,)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782094 is handled. Duration 110 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007399s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008521s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009643s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01061s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782095 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.11s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.727s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782096 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782097 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EA7D2A26D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EA7FD12DD0>, 219692.484)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EA7D2A2890>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782098 is not handled. Duration 421 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782098 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EA014835D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EA0153BF50>, 219706.015)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EA7FD2C1D0>
INFO:aiogram.event:Update id=657782099 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EA01480810>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EA0153BF50>, 219711.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EA014831D0>
INFO:aiogram.event:Update id=657782100 is handled. Duration 203 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EA014831D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EA0153BF50>, 219715.046)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EA01483810>
INFO:aiogram.event:Update id=657782101 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 40.14s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782102 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 41.23s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 41.85s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782103 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 40.21s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782104 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 41.76s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782105 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 40.24s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EA0155ABD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EA0153BF50>, 219732.671)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EA7FCF1990>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782106 is not handled. Duration 328 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782106 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 47.48s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782107 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 48.51s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 49.13s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782108 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 47.27s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782109 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 49.3s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782110 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 52.89s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 53.51s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782111 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 52.07s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782112 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 51.23s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EA014ABFD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EA01544C20>, 219743.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EA01561ED0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782113 is not handled. Duration 390 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782113 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001EA014A8090>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001EA0153BEE0>, 219755.64)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001EA014A8250>
INFO:aiogram.event:Update id=657782114 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782115 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005284s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0063s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007659s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01117s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782116 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.718s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 9.601s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782117 is handled. Duration 390 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782118 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026155B00FD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000261553AEE40>, 219861.109)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026155A92050>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782119 is not handled. Duration 344 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782119 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026151E77C50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000261553AE350>, 219878.406)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026151E74150>
INFO:aiogram.event:Update id=657782120 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782121 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005249s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006351s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007458s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008804s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782122 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.24s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 7.169s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782123 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782124 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C504171B90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C503A9AD60>, 220015.953)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C504171AD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782125 is not handled. Duration 342 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782125 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C504173A90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C50422BEE0>, 220031.781)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C5041720D0>
INFO:aiogram.event:Update id=657782126 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782127 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007699s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008675s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009601s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01053s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00137s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782128 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.209s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.669s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782129 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782130 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00117s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021DA0262610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021DA0256D60>, 220070.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021DA027ECD0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782131 is not handled. Duration 500 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782131 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021DA09720D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021DA09FBF50>, 220081.828)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021DA0988910>
INFO:aiogram.event:Update id=657782132 is handled. Duration 297 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782133 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006257s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007211s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008068s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008925s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782134 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.63s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.204s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782135 is handled. Duration 469 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782136 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F4A74117D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001F4A6C96D60>, 220385.0)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001F4A7411650>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782137 is not handled. Duration 375 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782137 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
INFO:aiogram.event:Update id=657782138 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782138 by bot id=7128547705
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007403s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008445s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009319s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01019s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782139 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.048s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 13.51s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782140 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782141 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D72B0CB990>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D73017AD60>, 220462.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D72C741610>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782142 is not handled. Duration 375 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782142 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
INFO:aiogram.event:Update id=657782143 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782143 by bot id=7128547705
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
INFO:aiogram.event:Update id=657782144 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782144 by bot id=7128547705
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00130s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008038s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009966s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01116s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01223s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782145 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.069s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.001s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782146 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782147 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00122s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001C8BF07A510>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001C8BF056D60>, 220675.984)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001C8BF7815D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782148 is not handled. Duration 328 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782148 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
INFO:aiogram.event:Update id=657782149 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782149 by bot id=7128547705
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: process_pre_checkout_query() missing 1 required positional argument: 'message'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005812s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00702s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008084s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009379s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782150 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.9994s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.903s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782151 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782152 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000011C833F1690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000011C82D46D60>, 221650.625)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000011C833F1490>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782153 is not handled. Duration 342 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782153 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 102, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000011C833F1A50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000011C834ABD90>, 221663.25)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000011C833F3410>
INFO:aiogram.event:Update id=657782154 is handled. Duration 328 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782155 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005756s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007049s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007993s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008841s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782156 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.9677s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.98s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782157 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00154s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782158 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.7015s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782159 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00105s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000215E3462810>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000215E2D3ADD0>, 221710.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000215E34622D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782160 is not handled. Duration 328 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782160 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 99, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000215E34B75D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000215E2D3AF90>, 221722.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000215E3462610>
INFO:aiogram.event:Update id=657782161 is handled. Duration 235 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782162 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00101s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00692s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007883s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008752s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009637s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782163 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.037s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.926s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782164 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782165 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021032D41A10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002103267AD60>, 221777.828)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021032D41550>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782166 is not handled. Duration 342 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782166 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 99, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021032D80250>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000021032E0BE70>, 221788.906)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000021032D83E90>
INFO:aiogram.event:Update id=657782167 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782168 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0076s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008814s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009684s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01052s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00033s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782169 is handled. Duration 468 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.107s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.788s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782170 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782171 is handled. Duration 358 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00115s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AED2441450>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AED1D92D60>, 221834.187)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AED24407D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782172 is not handled. Duration 327 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782172 by bot id=7128547705
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 64, in user_menu
    await buy_subscription(callback, callback_data, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 99, in buy_subscription
    await update_user_sub_id(user_id, subscribe_id)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: update_user_sub_id() missing 1 required positional argument: 'subscribe_id'
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AED24A2010>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AED24FBE70>, 221847.765)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AED24A0750>
INFO:aiogram.event:Update id=657782173 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782174 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005234s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006596s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0075s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008316s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00122s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005607s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00665s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007546s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008692s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782176 is handled. Duration 1250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.265s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.093s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782177 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782178 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CF232C16D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001CF22B7AE40>, 221893.734)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001CF232C14D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782179 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CF2332D010>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001CF22B7AF90>, 221906.125)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001CF23339C50>
INFO:aiogram.event:Update id=657782180 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782181 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006308s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00743s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008427s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009434s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782182 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.11s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 1.693s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782183 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782184 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002C6899916D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002C689202EB0>, 221936.265)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002C68921EF90>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782185 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002C68983C790>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002C689202F90>, 221948.218)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002C689789DD0>
INFO:aiogram.event:Update id=657782186 is handled. Duration 389 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782187 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0056s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006543s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007519s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008411s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782188 is handled. Duration 264 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.153s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.77s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782189 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782190 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000014787351CD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000014786C12E40>, 222086.984)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000014787351B10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782191 is handled. Duration 250 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000014786D5B190>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000014786C11E80>, 222103.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001478738E410>
INFO:aiogram.event:Update id=657782192 is handled. Duration 405 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782193 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00518s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006168s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007175s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008393s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782194 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.359s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.904s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782195 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00075s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782196 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F12468C610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001F124092E40>, 222132.14)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001F123FE89D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782197 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F1241E43D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001F124092F90>, 222151.64)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001F1242812D0>
INFO:aiogram.event:Update id=657782198 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782199 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00122s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005901s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006856s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007828s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009162s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782200 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.068s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.836s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782201 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00127s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782202 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00203s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002572BDE0FD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002572B652E40>, 222371.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002572BDD3B90>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782203 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782204 is not handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01422s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01538s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01647s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01756s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782205 is handled. Duration 311 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.136s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.749s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782206 is handled. Duration 327 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782207 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000163F73512D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000163F6C4EE40>, 265780.515)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000163F7350D90>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782208 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000163F73CBE90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000163F6C4EF90>, 265800.39)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000163F73C8690>
INFO:aiogram.event:Update id=657782209 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782210 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007147s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008442s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01007s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01123s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00133s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782211 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.191s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 4.744s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782212 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782213 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000193CCE91B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000193CC796EB0>, 266072.64)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000193CCE91B10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782214 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000193CCD509D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000193CC797000>, 266085.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000193CCEFE210>
INFO:aiogram.event:Update id=657782215 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782216 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782216 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'startswith'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 114, in process_link
    if text.startswith("http") or text.startswith("www."):
       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'startswith'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007561s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008562s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009569s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01056s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782217 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.111s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 2.822s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782218 is handled. Duration 311 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782219 is handled. Duration 483 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001FA98762050>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001FA98076EB0>, 266506.968)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001FA98761B10>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782220 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001FA9879C710>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001FA980764A0>, 266519.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001FA9879CE50>
INFO:aiogram.event:Update id=657782221 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782222 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782222 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'startswith'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 114, in process_link
    if text.startswith("http") or text.startswith("www."):
       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'startswith'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008854s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01003s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01103s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01206s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00075s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782223 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 2.005s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.465s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782224 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782225 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000028341591E90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000028340E2AEB0>, 266540.437)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000028341591210>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782226 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002834160D910>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000028340E2B000>, 266555.781)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002833EF7D690>
INFO:aiogram.event:Update id=657782227 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782228 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007152s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008272s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009287s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01029s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00124s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782229 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.057s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 3.177s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782230 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782231 is handled. Duration 389 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00112s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D22C8C06D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D22C1F6EB0>, 266660.343)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D22C8C1610>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782232 is handled. Duration 297 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D22884B110>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D22C1F7000>, 266672.781)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D22884A610>
INFO:aiogram.event:Update id=657782233 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782234 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 526.2s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782235 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 527.5s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 529.6s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782236 is handled. Duration 170 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 526.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782237 is handled. Duration 186 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 527.6s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D22C91EA50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D22C1F66D0>, 267187.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D22C8C08D0>
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782238 is handled. Duration 250 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D22C95C0D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D22C17BCB0>, 267205.078)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D22C95DB10>
INFO:aiogram.event:Update id=657782239 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782240 is handled. Duration 266 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00681s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008067s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009082s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01003s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00040s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04249s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04387s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04471s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04564s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0465s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00085s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00165s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00151s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00105s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782241 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782242 is handled. Duration 188 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782243 is handled. Duration 140 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782244 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 26.76s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782245 is handled. Duration 92 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 28.66s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782246 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ('', 3, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782247 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782248 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.902s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 35.96s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782249 is handled. Duration 188 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782250 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026FBEB11050>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026FBE50BC40>, 267283.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026FB944AED0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004609s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01223s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01423s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782251 is handled. Duration 280 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026FBEB26B10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026FBE48BC40>, 267312.421)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026FBEB26C90>
INFO:aiogram.event:Update id=657782252 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 31.69s ago] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 31.7s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 31.96s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] (datetime.datetime(2024, 5, 14, 13, 16, 22, 694344), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657782253 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782254 is handled. Duration 327 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782255 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782256 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 318.6s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782257 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 319.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782258 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 292.8s ago] ('', 2, 111.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782259 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 292.9s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782260 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 294s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 328s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782261 is handled. Duration 170 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 292.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782262 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 292.9s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782263 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 292s ago] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026FBEC36290>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026FBE508520>, 267575.015)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026FBEB4A010>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 292s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 292s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 292s ago] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782264 is handled. Duration 281 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026FBEC03B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026FBE508600>, 267588.609)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026FBEB07F50>
INFO:aiogram.event:Update id=657782265 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 307.9s ago] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 2
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 307.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 308.1s ago] (2,)
INFO:root:Updated user 334570076 subscription to 2
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 276.2s ago] (datetime.datetime(2024, 5, 14, 13, 20, 58, 874966), 2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657782266 is handled. Duration 360 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782267 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782268 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782269 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 409.7s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782270 is handled. Duration 141 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 411.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782271 is handled. Duration 204 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 383.6s ago] ('', 4, 59.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782272 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 384.1s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782273 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 385.2s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 419.2s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782274 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 384.1s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782275 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 384.9s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782276 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 386.7s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782277 is handled. Duration 186 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 385.8s ago] (3,)
ERROR:root:   : Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026FBEB85610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026FBEC10130>, 267668.765)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026FBEC37090>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 385.7s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 385.7s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 385.7s ago] (3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782278 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 410.3s ago] (3,)
ERROR:root:   : Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000026FBEAD4B50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000026FBE5088A0>, 267693.328)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000026FBEB87490>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 410.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 410.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782279 is handled. Duration 234 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00885s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01004s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01114s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01202s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782280 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.113s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 12.71s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782281 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782282 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.867s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782283 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 1.55s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782284 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (3,)
ERROR:root:   : Telegram server says - Bad Request: CURRENCY_TOTAL_AMOUNT_INVALID
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025433A0F4D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000025433277460>, 267721.343)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000025433A0F710>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.006469s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782285 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 6.414s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 18.01s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782286 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.535s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782287 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.649s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025433AD7290>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000025433277150>, 267725.984)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000025433ABBB50>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.625s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.628s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782288 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025433AD62D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000025433277C40>, 267738.734)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000025433AD66D0>
INFO:aiogram.event:Update id=657782289 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 19.64s ago] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 19.64s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 19.91s ago] (1,)
INFO:root:Updated user 334570076 subscription to 1
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00029s] (datetime.datetime(2024, 5, 14, 13, 23, 28, 969511), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:root:Subscription update successful
INFO:aiogram.event:Update id=657782290 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 133.1s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782291 is handled. Duration 235 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782292 is handled. Duration 156 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782293 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782293 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005887s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006954s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007969s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00963s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782294 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782295 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782296 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782296 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007477s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008506s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00947s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01041s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782297 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782298 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782299 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782299 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 196.1s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782300 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782301 is handled. Duration 218 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782302 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782302 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006414s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007359s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008187s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009004s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782303 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782304 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782305 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782305 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 179.4s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782306 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782307 is handled. Duration 172 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782308 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782308 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007999s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008997s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009926s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01115s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00107s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782309 is handled. Duration 327 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782310 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782311 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782311 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00555s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006924s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007826s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008646s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782312 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782313 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782314 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782314 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00124s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006738s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007877s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008798s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009676s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782315 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782316 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782317 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782317 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
INFO:aiogram.event:Update id=657782318 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782318 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004504s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005554s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006665s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007729s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005313s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006346s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00882s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01061s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00144s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782319 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782320 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782321 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782321 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00629s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007335s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008413s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00936s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782323 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782324 is handled. Duration 343 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782325 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782325 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005079s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005998s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006908s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007732s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782326 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782327 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782328 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782328 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005549s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00663s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008077s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009644s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782329 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782330 is handled. Duration 407 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782331 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782331 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007026s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008019s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00891s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009795s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782332 is handled. Duration 264 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782333 is handled. Duration 265 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782334 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782334 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 108, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005264s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007146s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008252s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009141s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782335 is handled. Duration 342 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782336 is handled. Duration 342 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782337 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782337 by bot id=7128547705
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 129, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 139, in send_link
    if not user:
           ^^^^
UnboundLocalError: cannot access local variable 'user' where it is not associated with a value
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008471s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009592s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01061s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01156s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782338 is handled. Duration 311 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782339 is handled. Duration 391 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782340 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782340 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 107, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00115s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008214s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01049s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01226s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01478s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00145s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782394 is handled. Duration 297 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782395 is handled. Duration 420 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782396 is not handled. Duration 0 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782396 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 106, in process_successful_payment
    if message.successful_payment.invoice_payload == "month_subscription":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'invoice_payload'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007369s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008452s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009604s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01067s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782397 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782398 is not handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004887s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006027s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006863s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007694s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00037s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00040s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02998s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03238s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0336s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03454s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03549s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00198s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00098s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00118s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00154s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00275s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00015s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782453 is handled. Duration 406 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782454 is handled. Duration 172 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782455 is handled. Duration 78 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782456 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 33.75s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782457 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 35.08s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782458 is handled. Duration 297 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] (' ', 3, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782459 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782460 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 3.609s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 44.68s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782461 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782462 is handled. Duration 186 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015310A1DE10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001531045B850>, 274369.921)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000153109C1990>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005963s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01532s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01703s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782463 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001531099F7D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000153103DFB60>, 274401.562)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000153109E0190>
INFO:aiogram.event:Update id=657782464 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 33.87s ago] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 33.87s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 34.12s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] (datetime.datetime(2024, 5, 14, 15, 14, 31, 757709), 3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782465 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 60.85s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782466 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782467 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 62.95s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 62.95s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://www.youtube.com/
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001531044DB90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001531045A660>, 274433.109)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015310A1E710>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] (datetime.datetime(2024, 4, 14, 15, 15, 1, 84413), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] (334570076, datetime.datetime(2024, 4, 13, 15, 15, 1, 88376))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 63.21s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 63.21s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782468 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782469 is handled. Duration 170 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 68.03s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 68.03s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://www.youtube.com/
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015310976810>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001531045BA80>, 274438.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015310977190>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.191s ago] (datetime.datetime(2024, 4, 14, 15, 15, 6, 275083), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 5.19s ago] (334570076, datetime.datetime(2024, 4, 13, 15, 15, 6, 278082))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 68.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 68.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.186s ago] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782470 is handled. Duration 531 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782471 is handled. Duration 170 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 73.31s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 73.31s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://www.youtube.com/
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001531095E710>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000015310B58210>, 274443.515)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001531095FA50>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 10.39s ago] (datetime.datetime(2024, 4, 14, 15, 15, 11, 475364), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 10.39s ago] (334570076, datetime.datetime(2024, 4, 13, 15, 15, 11, 479335))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 73.6s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 73.6s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 10.39s ago] (3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782472 is handled. Duration 407 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782473 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 79.05s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 79.05s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782474 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005927s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007747s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0102s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01164s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782475 is handled. Duration 0 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782476 is handled. Duration 515 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782477 is handled. Duration 0 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0206s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02241s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0238s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02505s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00043s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00053s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00048s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.08268s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.08502s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.08623s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0875s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.08904s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00110s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00139s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00136s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00179s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00134s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) SELECT p0::VARCHAR, p1::TIMESTAMP WITHOUT TIME ZONE, p2::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, now(), now(), 0), ($2::VARCHAR, now(), now(), 1)) AS imp_sen(p0, p1, p2, sen_counter) ORDER BY sen_counter RETURNING category.id, category.created, category.updated, category.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782483 is handled. Duration 360 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782484 is handled. Duration 421 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782485 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782486 is handled. Duration 202 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782487 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 215.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782488 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 217.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782489 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('', 5, 99.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782490 is handled. Duration 187 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782491 is handled. Duration 93 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782492 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 233.7s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782493 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 235.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782494 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 18.67s ago] ('', 10, 149.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782495 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782496 is handled. Duration 93 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782497 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 260.1s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782498 is handled. Duration 140 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 262.8s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782499 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 48.58s ago] ('', 100000, 299.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782500 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782501 is handled. Duration 235 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782502 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782503 is handled. Duration 155 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 413s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782504 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782505 is handled. Duration 625 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (3,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782506 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782507 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 431s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782508 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 433.1s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782509 is handled. Duration 389 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:UPDATE subscribe SET name=$1::VARCHAR, description=$2::INTEGER, price=$3::NUMERIC(5, 2), category_id=$4::INTEGER, updated=now() WHERE subscribe.id = $5::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] (' ', 100000, 299.0, 1, 3)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782510 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 437.2s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782511 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 24.2s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782512 is handled. Duration 453 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 351s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782513 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 423.4s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 527s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782514 is handled. Duration 311 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 159.6s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782515 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 181.4s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782516 is handled. Duration 608 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 196.1s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782517 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 520.7s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 624.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782518 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 212.6s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782519 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 219.1s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001478357DD10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000014782EDBBD0>, 57889.859)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000014782EB20D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00117s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005328s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00116s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01655s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01861s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782520 is handled. Duration 311 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000014783587FD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000014782EDBC40>, 57955.5)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000014783587190>
INFO:aiogram.event:Update id=657782521 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 69.4s ago] (334570076,)
INFO:root:Updating subscription for user 334570076 with subscription 1
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 69.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 288.8s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] (datetime.datetime(2024, 5, 15, 13, 47, 43, 487308), 5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782522 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 841s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782523 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782524 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 361.7s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 361.7s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://l.likee.video/v/RvtkCy
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000147830955D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000014782EDBA80>, 58252.125)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001478357E490>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] (datetime.datetime(2024, 4, 15, 13, 52, 36, 347795), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] (334570076, datetime.datetime(2024, 4, 14, 13, 52, 36, 351295))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 362.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 362.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00023s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782525 is handled. Duration 860 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782526 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 395s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 395s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://l.likee.video/v/RvtkCy
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000147835A9950>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000014782EDBAF0>, 58285.125)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000147835A9B90>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 33s ago] (datetime.datetime(2024, 4, 15, 13, 53, 9, 349051), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 33s ago] (334570076, datetime.datetime(2024, 4, 14, 13, 53, 9, 353180))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 395.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 395.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 33s ago] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782527 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782528 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 399s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 399s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://l.likee.video/v/RvtkCy
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001478352C2D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000147835D40C0>, 58289.25)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000014783591B50>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 37.12s ago] (datetime.datetime(2024, 4, 15, 13, 53, 13, 468242), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 37.12s ago] (334570076, datetime.datetime(2024, 4, 14, 13, 53, 13, 471742))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 399.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 399.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 37.12s ago] (3, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782529 is handled. Duration 561 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782530 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 403.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 403.9s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://l.likee.video/v/RvtkCy
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000147834E8D50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000014782EDB5B0>, 58294.0)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000014783591890>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 41.87s ago] (datetime.datetime(2024, 4, 15, 13, 53, 18, 220477), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 41.87s ago] (334570076, datetime.datetime(2024, 4, 14, 13, 53, 18, 223999))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 404.1s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 404.1s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 41.87s ago] (4, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782531 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782532 is handled. Duration 264 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 411.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 411.3s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://l.likee.video/v/RvtkCy
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000147830639D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000147835D4210>, 58301.453)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001478352C090>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 49.33s ago] (datetime.datetime(2024, 4, 15, 13, 53, 25, 675442), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 49.33s ago] (334570076, datetime.datetime(2024, 4, 14, 13, 53, 25, 679442))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 411.6s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 411.6s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 49.32s ago] (5, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782533 is handled. Duration 391 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 413.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 413.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782534 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01183s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01325s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01421s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01514s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00125s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782535 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.324s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 6.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782536 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782537 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 5.263s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 10.34s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782538 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 9.178s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782539 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008277s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0112s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01272s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01529s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782540 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 10.5s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782541 is handled. Duration 141 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007978s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009484s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01062s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01158s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782542 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 20.59s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782543 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 81.86s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 83.7s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782544 is handled. Duration 453 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] (2,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782545 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782545 by bot id=7128547705
IndexError: list index out of range
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 63, in user_menu
    text, reply_markup = await get_menu_content(
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\menu_processing.py", line 104, in get_menu_content
    return await subscriptions(session, level, category, page)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\menu_processing.py", line 72, in subscriptions
    subscribe = paginator.get_page()[0]
                ~~~~~~~~~~~~~~~~~~~~^^^
IndexError: list index out of range
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008204s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009625s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01076s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01174s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00037s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04381s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04519s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04618s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04727s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04865s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00075s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00096s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00142s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00171s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00200s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00031s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00014s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00102s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782546 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.487s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 5.545s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782547 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 10.39s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782548 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782549 is handled. Duration 235 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782550 is handled. Duration 313 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782551 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782552 is handled. Duration 93 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782553 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 103.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782554 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 104.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782555 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('', 5, 99.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782556 is handled. Duration 141 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782557 is handled. Duration 156 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782558 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 115.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782559 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 116.8s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782560 is handled. Duration 343 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 12.57s ago] ('', 10, 149.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782561 is handled. Duration 203 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782562 is handled. Duration 171 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782563 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 139.4s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782564 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 141.3s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782565 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[cached since 37.17s ago] (' ', 10000, 299.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782566 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 151.2s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782567 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 153.8s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 157.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782568 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782569 is handled. Duration 188 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 169.7s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 173.7s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782570 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 170.8s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782571 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01549s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01649s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01744s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01845s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('main',)
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.09573s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782576 is handled. Duration 281 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782577 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 6.845s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 7.026s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782578 is handled. Duration 453 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782579 is handled. Duration 390 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 2.19s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782580 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (2,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D5885CB490>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D588063380>, 225638.453)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D5885CB1D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005726s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01845s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.02242s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782581 is handled. Duration 296 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D5886541D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D588062430>, 225653.171)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D588655410>
INFO:aiogram.event:Update id=657782582 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 16.96s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 16.96s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 17.22s ago] (2,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] (datetime.datetime(2024, 4, 17, 12, 27, 39, 648943), 10, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782583 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 330.7s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782584 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 357s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782585 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782586 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 355.4s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 355.4s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://www.youtube.com
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D588767A10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D588063690>, 225994.093)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D58878B090>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] (datetime.datetime(2024, 4, 17, 12, 28, 18, 310674), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] (334570076, datetime.datetime(2024, 4, 16, 12, 28, 18, 315175))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 355.6s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 355.6s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782587 is handled. Duration 389 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 358.8s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 358.9s ago] (334570076,)
INFO:root:    : <strong> (username):</strong> mimimichaello
<strong>:</strong> https://www.youtube.com
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D588767A10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D5880624A0>, 225997.718)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D588753250>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 3.629s ago] (datetime.datetime(2024, 4, 17, 12, 28, 21, 939234), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[cached since 3.628s ago] (334570076, datetime.datetime(2024, 4, 16, 12, 28, 21, 943746))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 359.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 359.3s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 3.622s ago] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782588 is handled. Duration 608 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006401s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008115s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009692s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01105s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782590 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782591 is handled. Duration 405 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005126s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET daily_link_limit=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782592 is handled. Duration 203 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006427s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008323s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009464s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01048s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00039s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00036s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0404s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0423s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04358s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04484s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04724s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00089s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00090s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00126s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	last_link_sent_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00125s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00182s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007157s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008416s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00947s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01076s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00045s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03408s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03539s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03629s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03716s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0381s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00070s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00107s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	last_link_sent_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00132s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782593 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782594 is handled. Duration 171 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782595 is handled. Duration 92 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782596 is handled. Duration 94 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 37.83s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782597 is handled. Duration 92 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 39.59s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782598 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ('', 2, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782599 is handled. Duration 141 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782600 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782601 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".last_link_sent_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".last_link_sent_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004443s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, last_link_sent_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::TIMESTAMP WITHOUT TIME ZONE, $7::INTEGER, $8::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] (334570076, 'mimimichaello', None, None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782602 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782602 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 93, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 110, in send_link
    if user.subscription_end_date <= datetime.now():
       ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005494s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007014s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008486s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009707s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00049s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00049s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03351s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03507s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03596s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03678s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03761s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00097s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00087s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00115s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	last_link_sent_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00120s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00114s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00012s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782603 is handled. Duration 391 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782604 is handled. Duration 203 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782605 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782606 is handled. Duration 156 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 25.51s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782607 is handled. Duration 93 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 27.28s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782608 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('', 2, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782609 is handled. Duration 264 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782610 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782611 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".last_link_sent_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".last_link_sent_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.002942s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, last_link_sent_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::TIMESTAMP WITHOUT TIME ZONE, $7::INTEGER, $8::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] (334570076, 'mimimichaello', None, None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782612 is not handled. Duration 15 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782612 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if user.subscription_end_date <= datetime.now():
       ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006201s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007254s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008281s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009193s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02977s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03113s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03199s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0329s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03448s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00116s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00084s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00133s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00117s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00115s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00106s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00082s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782613 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782614 is handled. Duration 327 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004488s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782615 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782615 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if user.subscription_end_date <= datetime.now():
       ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005728s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00689s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007921s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008878s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00041s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00052s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03864s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04013s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04112s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0421s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0431s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00090s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00153s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00153s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00136s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00093s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782616 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782617 is handled. Duration 421 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00103s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005153s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00117s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782618 is not handled. Duration 77 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782618 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if user.subscription_end_date <= datetime.now():
       ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'subscription_end_date'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00178s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006916s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008214s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009325s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01022s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00098s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0374s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03875s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03966s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04047s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04136s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00083s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00150s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00142s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00138s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00143s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782619 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782620 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004252s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782621 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782621 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 110, in send_link
    links_sent_today = user.links_sent
                       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005668s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006756s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007771s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008724s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00106s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00035s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03689s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03833s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03925s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04011s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04097s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00121s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00109s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00107s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00144s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00095s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00194s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782622 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782623 is handled. Duration 437 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00111s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004276s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782624 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782624 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 110, in send_link
    links_sent_today = user.links_sent
                       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
INFO:aiogram.event:Update id=657782625 is handled. Duration 421 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782626 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782627 is handled. Duration 172 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782628 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 170.1s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782629 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 171.8s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782630 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ('', 2, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782631 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 177.2s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782632 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782633 is handled. Duration 437 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 180.5s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 182.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782634 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782635 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020C5B73C6D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020C5B57D390>, 227823.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020C5B5EEBD0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 177.5s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 177.5s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782636 is handled. Duration 264 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020C5B5BA610>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020C5B57D630>, 227839.843)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020C5B6CD0D0>
INFO:aiogram.event:Update id=657782637 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 196s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 196s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 18.73s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] (datetime.datetime(2024, 5, 17, 12, 59, 6, 277938), 2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782638 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 204.8s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782639 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782640 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 205.5s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 205.5s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020C5B6EEE90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020C5B57D550>, 227851.953)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020C5B699CD0>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] (datetime.datetime(2024, 4, 17, 12, 59, 16, 175254), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] (334570076, datetime.datetime(2024, 4, 16, 12, 59, 16, 180773))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 205.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 205.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00022s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782641 is handled. Duration 467 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006622s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01007s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0118s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01294s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00037s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00037s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03779s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0399s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04439s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04625s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04727s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00072s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00092s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00122s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00151s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00092s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782642 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782643 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004502s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782644 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782644 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if user.current_subscription_id:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00811s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009685s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.011s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01232s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00056s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00047s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00042s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04409s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04638s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04802s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0501s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.05249s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00163s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00144s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00254s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00145s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00118s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782645 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782646 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004792s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782647 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782647 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if user.current_subscription_id == None:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00733s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009105s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01009s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01097s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0315s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03285s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03371s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03461s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03548s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00078s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00136s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00175s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00299s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00235s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782648 is handled. Duration 281 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782649 is handled. Duration 359 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004321s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782650 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782650 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if user.current_subscription_id == None:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00075s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00704s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009181s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01017s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01106s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03365s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03498s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0358s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03668s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03777s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00242s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00133s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00095s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00120s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00160s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00131s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782651 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782652 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004483s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782653 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782653 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if user.current_subscription_id == None:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005054s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006311s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007333s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008311s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00108s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03482s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03613s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03708s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03809s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03896s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00072s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00083s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00224s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00112s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00145s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00144s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782654 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782655 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.003969s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782656 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782656 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 111, in send_link
    return
          
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007366s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008294s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009266s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01026s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00054s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03141s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03279s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03377s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03475s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03623s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00154s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00086s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00116s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00228s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00120s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00012s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00222s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007883s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009195s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01037s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01134s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00147s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00036s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0389s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04037s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04139s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04228s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04323s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00070s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00150s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00111s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00185s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782657 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782658 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004464s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782659 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782659 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 118, in send_link
    links_sent_today = user.links_sent
                       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007315s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009115s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01008s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01096s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03169s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03311s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03407s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0349s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03571s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00080s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00078s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00134s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00126s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00084s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782660 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782661 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004391s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782662 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782662 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 118, in send_link
    links_sent_today = user.links_sent
                       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006974s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008199s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009167s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01007s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00042s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02909s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03045s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03136s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03246s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03335s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00095s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00084s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00096s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00111s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00109s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782663 is handled. Duration 344 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782664 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004902s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782665 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782665 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005128s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006396s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008665s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01206s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0358s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03748s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03846s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03941s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04109s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00122s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00167s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00097s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00131s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00116s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00187s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782666 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782667 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.003823s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782668 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782668 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005983s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00832s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01163s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01314s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00039s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03629s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03767s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0387s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03976s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04241s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00078s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00155s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00108s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00154s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00094s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782669 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782670 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00128s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005277s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782671 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782671 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005835s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007304s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009623s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01145s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00035s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03138s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0327s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03364s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03452s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03543s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00068s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00099s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00089s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00120s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00081s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782672 is handled. Duration 265 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782673 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004203s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782674 is not handled. Duration 77 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782674 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00112s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008557s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01001s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01097s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01208s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00036s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00044s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00113s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03526s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03715s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03976s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04351s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04507s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00071s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00110s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00108s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00172s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00101s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782675 is handled. Duration 282 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782676 is handled. Duration 280 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.003759s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782677 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782677 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006722s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008423s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009362s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0103s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00037s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03111s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03259s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03371s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03472s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03565s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00080s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00078s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00118s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00115s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00080s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00053s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782678 is handled. Duration 265 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782679 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.003972s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782680 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782680 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004944s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00604s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007131s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008668s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00074s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03284s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03442s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03549s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03637s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03724s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00077s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00078s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00203s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00142s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00141s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782681 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 15.76s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782682 is handled. Duration 342 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782683 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004628s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782684 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782684 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005846s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007172s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0111s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0131s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00039s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00121s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04036s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04462s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04588s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04683s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04774s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00091s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00076s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00125s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00197s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00095s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00057s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782685 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782686 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004128s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782687 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782687 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00078s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008382s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01039s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01156s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01247s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00035s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00065s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00072s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0349s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03633s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03782s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03917s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04106s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00076s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00156s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00166s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00264s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00148s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00013s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782688 is handled. Duration 327 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782689 is handled. Duration 296 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004948s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782690 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782690 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 111, in send_link
    if user.links_sent >= user.daily_link_limit:
       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005907s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007128s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008274s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009345s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00059s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00035s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03482s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03621s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03714s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03804s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03898s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00081s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00111s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER NOT NULL, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00153s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00105s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782691 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782692 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00120s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005604s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00114s] (334570076, 'mimimichaello', 0, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782693 is not handled. Duration 94 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782693 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: INSERT  UPDATE   "user"     "user_current_subscription_id_fkey"
DETAIL:   (current_subscription_id)=(0)    "subscribe".
[SQL: INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated]
[parameters: (334570076, 'mimimichaello', 0, None, None, 0, 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: INSERT  UPDATE   "user"     "user_current_subscription_id_fkey"
DETAIL:   (current_subscription_id)=(0)    "subscribe".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: INSERT  UPDATE   "user"     "user_current_subscription_id_fkey"
DETAIL:   (current_subscription_id)=(0)    "subscribe".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 105, in send_link
    await orm_add_user(session, user_id, username=username)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 201, in orm_add_user
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: INSERT  UPDATE   "user"     "user_current_subscription_id_fkey"
DETAIL:   (current_subscription_id)=(0)    "subscribe".
[SQL: INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated]
[parameters: (334570076, 'mimimichaello', 0, None, None, 0, 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00104s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009855s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01133s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01307s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01493s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00105s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00042s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00096s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.07508s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.07799s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.08051s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.08259s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.08649s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00222s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00256s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00230s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00257s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00182s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782694 is handled. Duration 234 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782695 is handled. Duration 172 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.003914s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782696 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782696 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005404s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007846s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009688s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01093s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03051s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03194s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03291s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03375s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03461s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00067s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00076s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00086s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00117s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00082s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00016s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782697 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782698 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004242s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001889AFB2310>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001889A945E80>, 230528.468)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001889AFB2690>
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] (datetime.datetime(2024, 4, 17, 13, 43, 52, 704228), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT sum(link_usage.links_sent) AS sum_1 
FROM link_usage 
WHERE link_usage.user_id = $1::INTEGER AND link_usage.created >= $2::TIMESTAMP WITHOUT TIME ZONE
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] (334570076, datetime.datetime(2024, 4, 16, 13, 43, 52, 708257))
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3831s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.3843s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00021s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782699 is handled. Duration 609 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006369s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007585s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008511s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009386s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00041s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02952s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03114s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03234s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03327s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03406s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00067s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00111s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00140s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00135s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00078s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782700 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782701 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004241s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782702 is not handled. Duration 77 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782702 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 120, in send_link
    if user.links_sent >= user.daily_link_limit:
       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00070s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00628s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007643s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008825s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009931s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00043s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00040s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03686s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03854s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03954s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04048s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04142s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00079s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00099s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00121s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00131s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00102s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00013s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00071s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782703 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782704 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004247s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00043s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782705 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782705 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 109, in send_link
    if not user.current_subscription_id:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'current_subscription_id'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.004876s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006023s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007235s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008308s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00073s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03447s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03585s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03671s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03754s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03834s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00076s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00079s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00097s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00122s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00087s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00153s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782706 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782707 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00099s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004254s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782708 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782708 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 116, in send_link
    if user.links_sent == user.daily_link_limit:
       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008242s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009207s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01012s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01102s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00043s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00114s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03394s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0356s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03794s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04097s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04211s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00068s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00148s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00100s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00147s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00193s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00077s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00022s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782709 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782710 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00089s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004403s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782711 is not handled. Duration 78 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782711 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 116, in send_link
    if user.links_sent >= user.daily_link_limit:
       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009843s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01084s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01173s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01266s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00021s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00041s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00038s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00092s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03751s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04083s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04333s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04755s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.05041s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00544s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00152s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00212s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00477s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00207s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00080s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00113s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782712 is handled. Duration 358 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782713 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00084s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004262s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782714 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782714 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 116, in send_link
    if user.links_sent >= user.daily_link_limit:
       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00213s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008416s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009976s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01105s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01199s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00042s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00033s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00064s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03532s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03758s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03957s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04078s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0418s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00069s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00100s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00102s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00181s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00092s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00100s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782715 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782716 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00086s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004569s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782717 is not handled. Duration 77 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782717 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 115, in send_link
    links_sent_today = user.links_sent
                       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006732s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007982s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008917s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009794s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00040s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00045s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00041s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03355s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03487s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03642s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03831s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03927s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00118s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00247s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00527s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00205s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00099s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00190s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00052s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782718 is handled. Duration 296 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782719 is handled. Duration 264 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00092s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.003952s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782720 is not handled. Duration 62 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782720 by bot id=7128547705
AttributeError: 'NoneType' object has no attribute 'links_sent'
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 92, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 115, in send_link
    links_sent_today = user.links_sent
                       ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'links_sent'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00094s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005349s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007174s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008679s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009618s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00036s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03042s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03201s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03296s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03382s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03461s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00086s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00084s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00111s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00114s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00085s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782721 is handled. Duration 266 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782722 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004309s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00076s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01131s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002B736FD5D90>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002B73692B000>, 231419.906)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002B736FD70D0>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (datetime.datetime(2024, 4, 17, 13, 58, 44, 136907), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782723 is handled. Duration 546 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782724 is handled. Duration 405 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 37.07s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 37.07s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782725 is handled. Duration 218 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00097s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006893s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007898s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008778s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009644s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00030s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00039s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.02949s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03078s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03172s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03278s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03462s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00236s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00140s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00215s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00257s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00166s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782726 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782727 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00098s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.00454s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01119s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D0B60D7650>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D0B5B2B000>, 232028.406)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D0B60B0A10>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] (datetime.datetime(2024, 4, 17, 14, 8, 52, 637963), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782728 is handled. Duration 546 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 11.02s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782729 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782730 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 7.418s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 7.424s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782731 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 95.48s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782732 is handled. Duration 342 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782733 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 94.72s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 94.72s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D0B5D20F50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002D0B5B2B310>, 232123.109)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002D0B60D4CD0>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 94.7s ago] (datetime.datetime(2024, 4, 17, 14, 10, 27, 334013), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782734 is handled. Duration 437 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005524s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00667s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008177s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01222s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00040s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00027s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03573s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03707s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03792s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03872s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03952s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00169s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00073s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00139s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00108s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00189s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00032s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00090s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008644s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009912s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01116s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01269s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00039s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00041s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00034s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04546s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04737s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04881s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.05194s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.05454s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00084s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00086s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00116s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00219s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00087s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00039s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782735 is handled. Duration 843 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782736 is handled. Duration 282 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782737 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782738 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782739 is handled. Duration 140 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 23.92s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782740 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 25.75s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782741 is handled. Duration 266 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00041s] ('', 2, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782742 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 26.64s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782743 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 29.17s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 32.37s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782744 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782745 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00108s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AB08088510>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AB07A1BB60>, 232829.812)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AB080A08D0>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00142s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004862s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01108s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01226s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00028s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782746 is handled. Duration 358 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AB0808B250>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AB0799BBD0>, 232842.296)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AB0796C390>
INFO:aiogram.event:Update id=657782747 is handled. Duration 217 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.55s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.55s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.89s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00042s] (datetime.datetime(2024, 4, 17, 14, 23, 28, 594064), 2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782748 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 74.23s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782749 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782750 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 49.53s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 49.53s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AB08191690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AB07A1B540>, 232879.64)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AB08099810>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00064s] (datetime.datetime(2024, 4, 17, 14, 23, 3, 862861), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 49.83s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782751 is handled. Duration 453 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782752 is handled. Duration 780 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 54.83s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 54.83s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AB08193690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AB07A1B000>, 232884.953)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AB08193F50>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.306s ago] (datetime.datetime(2024, 4, 17, 14, 23, 9, 168604), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 55.14s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 5.305s ago] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782753 is handled. Duration 437 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 115.5s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782754 is handled. Duration 233 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782755 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 88.06s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 88.06s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782756 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782757 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 121s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 121s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782758 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 206.7s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 209.9s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782759 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 181.6s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782760 is handled. Duration 203 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 181.5s ago] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AB081A9410>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AB07A1B9A0>, 233011.281)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AB08198A90>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 181.5s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 181.5s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782761 is handled. Duration 265 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AB081998D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001AB0799BBD0>, 233025.609)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001AB08187890>
INFO:aiogram.event:Update id=657782762 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 198s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 198s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 198.4s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00038s] (datetime.datetime(2024, 4, 17, 14, 26, 32, 70059), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782763 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 235.1s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782764 is handled. Duration 92 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782765 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 209.1s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 209.1s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782766 is handled. Duration 171 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00093s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008121s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0126s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01481s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01646s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00055s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00065s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00100s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00047s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.05275s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.05458s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.05569s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.057s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.06085s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00129s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00181s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00132s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00246s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00096s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00050s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782767 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782768 is handled. Duration 343 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782769 is handled. Duration 108 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782770 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 20.36s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782771 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 22.01s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782772 is handled. Duration 234 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('', 2, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782773 is handled. Duration 157 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782774 is handled. Duration 110 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 1.844s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 29.17s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782775 is handled. Duration 233 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00091s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782776 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00123s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017D0F4F9BD0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017D0EF8BA80>, 233338.546)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017D0F502E50>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004667s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00065s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.0117s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.0152s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00044s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782777 is handled. Duration 281 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017D0F4F8690>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017D0EF0BBD0>, 233352.343)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017D0F4A1B10>
INFO:aiogram.event:Update id=657782778 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 16.2s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 16.2s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 16.46s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00074s] (datetime.datetime(2024, 4, 17, 14, 31, 58, 965066), 2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782779 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 26.66s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782780 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782781 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.19s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.19s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017D0F590250>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017D0F6887C0>, 233365.015)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017D0B5FD410>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00059s] (datetime.datetime(2024, 4, 17, 14, 31, 9, 226584), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.47s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782782 is handled. Duration 375 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782783 is handled. Duration 282 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 30.32s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 30.32s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017D0F626F50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017D0EF89B00>, 233369.156)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017D0F6240D0>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.149s ago] (datetime.datetime(2024, 4, 17, 14, 31, 13, 374755), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 30.62s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.147s ago] (2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782784 is handled. Duration 406 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782785 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 35.71s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 35.71s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782786 is handled. Duration 155 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782787 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 64.52s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 64.52s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 38.06s ago] (0, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782788 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782789 is handled. Duration 202 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 74.42s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 74.42s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017D0F6240D0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017D0EF8BB60>, 233413.25)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017D0F624310>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 48.24s ago] (datetime.datetime(2024, 4, 17, 14, 31, 57, 470457), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 74.71s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 48.24s ago] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782790 is handled. Duration 421 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782791 is handled. Duration 312 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 98.66s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 98.66s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 98.66s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782792 is not handled. Duration 14 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782792 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:21.422085).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:21.422085).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:21.422085).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 93, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 135, in send_link
    await reset_sub(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 276, in reset_sub
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:21.422085).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:aiogram.event:Update id=657782793 is handled. Duration 577 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 126.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 126.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 126.9s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 28.22s ago] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782794 is not handled. Duration 15 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782794 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:49.635076).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:49.635076).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:49.635076).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 93, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 135, in send_link
    await reset_sub(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 276, in reset_sub
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:32:49.635076).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00122s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006401s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007605s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008712s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009765s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00073s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782795 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782796 is handled. Duration 344 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00095s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.007383s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.009249s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00037s] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782797 is not handled. Duration 31 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782797 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:33:59.587608).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:33:59.587608).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:33:59.587608).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 93, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 135, in send_link
    await reset_sub(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 276, in reset_sub
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:33:59.587608).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005597s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006626s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008484s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01006s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00054s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782798 is handled. Duration 312 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782799 is handled. Duration 250 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00083s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.00463s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.006145s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782800 is not handled. Duration 15 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782800 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:34:52.71425).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:34:52.71425).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:34:52.71425).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 93, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 135, in send_link
    await reset_sub(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 276, in reset_sub
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:34:52.71425).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00066s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.005559s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006832s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007788s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008924s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00055s] ()
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00085s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782801 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782802 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00110s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.005402s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.007693s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00036s] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782803 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782803 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:35:54.140536).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:35:54.140536).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:35:54.140536).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 93, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 127, in send_link
    await reset_sub(session, user_id)
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 276, in reset_sub
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:35:54.140536).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 13.37s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782804 is handled. Duration 94 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782805 is handled. Duration 171 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782806 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.38s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.38s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.38s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 26.37s ago] (None, None, None, 334570076)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782807 is not handled. Duration 16 ms by bot id=7128547705
ERROR:aiogram.event:Cause exception while process update id=657782807 by bot id=7128547705
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:36:20.519116).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 538, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.NotNullViolationError:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:36:20.519116).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:36:20.519116).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\!\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\middlewares\db.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 93, in process_link
    await send_link(message, session)
  File "D:\courses\telegram\simple_bot\handlers\user_private.py", line 127, in send_link
    #     await reset_sub(session, user_id)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\courses\telegram\simple_bot\database\orm_query.py", line 276, in reset_sub
    await session.commit()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1972, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1257, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1232, in _prepare_impl
    self.session.flush()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4296, in flush
    self._flush(objects)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4431, in _flush
    with util.safe_reraise():
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4392, in _flush
    flush_context.execute()
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1422, in execute
    return meth(
           ^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 514, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1644, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1850, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1990, in _exec_single_context
    self._handle_dbapi_exception(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2357, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1971, in _exec_single_context
    self.dialect.do_execute(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 919, in do_execute
    cursor.execute(statement, parameters)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 572, in execute
    self._adapt_connection.await_(
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 131, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 501, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "d:\courses\telegram\simple_bot\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 789, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>:  NULL   "daily_link_limit"  "user"   NOT NULL
DETAIL:     (334570076, 2024-04-17 14:30:42.504416, mimimichaello, null, null, 2024-04-17 14:31:57.470457, 1, null, 2024-04-17 14:30:42.504416, 2024-04-17 14:36:20.519116).
[SQL: UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER]
[parameters: (None, None, None, 334570076)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00081s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008117s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.00917s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01013s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.01103s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00023s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00044s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00026s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00054s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03488s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03782s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03988s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04113s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.04207s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00077s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00092s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00117s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00216s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00087s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00048s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00069s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782808 is handled. Duration 280 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782809 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00072s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004019s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00067s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01029s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000186337A7790>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x00000186331D7070>, 233738.453)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000186337B9A10>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00049s] (datetime.datetime(2024, 4, 17, 14, 37, 22, 674977), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782810 is handled. Duration 485 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 3.516s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 3.518s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782811 is handled. Duration 141 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 8.509s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 8.511s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782812 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 9.422s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 9.424s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782813 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 10.18s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 10.19s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782814 is handled. Duration 110 ms by bot id=7128547705
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00088s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006332s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007329s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008289s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009271s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00024s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00031s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00029s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00088s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00028s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03094s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03251s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03461s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0372s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03833s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00067s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00142s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00099s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00130s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00083s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00035s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00046s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:aiogram.event:Update id=657782815 is handled. Duration 407 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782816 is handled. Duration 219 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782817 is handled. Duration 171 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782818 is handled. Duration 218 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 26.41s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782819 is handled. Duration 108 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 28.13s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782820 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:INSERT INTO subscribe (name, description, price, category_id, created, updated) VALUES ($1::VARCHAR, $2::INTEGER, $3::NUMERIC(5, 2), $4::INTEGER, now(), now()) RETURNING subscribe.id, subscribe.created, subscribe.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00056s] ('', 2, 123.0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782821 is handled. Duration 109 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00060s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782822 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.8557s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 37.33s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782823 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00079s] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782824 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00045s] (1,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B25A755C50>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B25A14B8C0>, 234107.312)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B25A756690>
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00109s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004562s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00061s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01408s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.01708s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00058s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782825 is handled. Duration 266 ms by bot id=7128547705
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B25A756410>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B25A14BB60>, 234119.687)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B25A121B50>
INFO:aiogram.event:Update id=657782826 is handled. Duration 531 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.71s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.71s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 14.96s ago] (1,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET subscription_end_date=$1::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$2::INTEGER, updated=now() WHERE "user".id = $3::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00030s] (datetime.datetime(2024, 4, 17, 14, 44, 46, 240647), 2, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782827 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 19.78s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782828 is handled. Duration 125 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 20.95s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 57.42s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782829 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT subscribe.id, subscribe.name, subscribe.description, subscribe.price, subscribe.category_id, subscribe.created, subscribe.updated 
FROM subscribe 
WHERE subscribe.category_id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 20.35s ago] (1,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782830 is handled. Duration 342 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 23.37s ago] ('catalog',)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[cached since 59.84s ago] ()
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782831 is handled. Duration 219 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 23.82s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782832 is handled. Duration 187 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782833 is handled. Duration 171 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 23.56s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 23.56s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001B25A6C0C10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001B25A8408A0>, 234131.14)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001B25A121B50>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00063s] (datetime.datetime(2024, 4, 17, 14, 43, 55, 352620), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 23.83s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET links_sent=$1::INTEGER, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00047s] (1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782834 is handled. Duration 375 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 76.93s ago] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782835 is handled. Duration 328 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782836 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 76.94s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 76.94s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 76.94s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET current_subscription_id=$1::INTEGER, subscription_end_date=$2::TIMESTAMP WITHOUT TIME ZONE, daily_link_limit=$3::INTEGER, updated=now() WHERE "user".id = $4::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00034s] (None, None, 1, 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782837 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782838 is handled. Duration 328 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 147.2s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 147.2s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782839 is handled. Duration 109 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
DEBUG:asyncio:Using proactor: IocpProactor
INFO:sqlalchemy.engine.Engine:select pg_catalog.version()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:select current_schema()
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:show standard_conforming_strings
INFO:sqlalchemy.engine.Engine:[raw sql] ()
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00125s] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.006466s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.007656s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.008719s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.009624s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
DROP TABLE link_usage
INFO:sqlalchemy.engine.Engine:[no key 0.00022s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE "user"
INFO:sqlalchemy.engine.Engine:[no key 0.00039s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE subscribe
INFO:sqlalchemy.engine.Engine:[no key 0.00075s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE category
INFO:sqlalchemy.engine.Engine:[no key 0.00032s] ()
INFO:sqlalchemy.engine.Engine:
DROP TABLE menu_text
INFO:sqlalchemy.engine.Engine:[no key 0.00025s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0317s ago] ('menu_text', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0348s ago] ('category', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.0361s ago] ('subscribe', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03711s ago] ('user', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO:sqlalchemy.engine.Engine:[cached since 0.03806s ago] ('link_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO:sqlalchemy.engine.Engine:
CREATE TABLE menu_text (
	id SERIAL NOT NULL, 
	name VARCHAR(15) NOT NULL, 
	description TEXT, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00077s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE category (
	id SERIAL NOT NULL, 
	name VARCHAR(150) NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00085s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE subscribe (
	id SERIAL NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	description INTEGER NOT NULL, 
	price NUMERIC(5, 2) NOT NULL, 
	category_id INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES category (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00099s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE "user" (
	id SERIAL NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	username VARCHAR(50) NOT NULL, 
	current_subscription_id INTEGER, 
	subscription_end_date TIMESTAMP WITHOUT TIME ZONE, 
	link_sent TIMESTAMP WITHOUT TIME ZONE, 
	links_sent INTEGER NOT NULL, 
	daily_link_limit INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(current_subscription_id) REFERENCES subscribe (id)
)


INFO:sqlalchemy.engine.Engine:[no key 0.00125s] ()
INFO:sqlalchemy.engine.Engine:
CREATE TABLE link_usage (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	links_sent INTEGER NOT NULL, 
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES "user" (id) ON DELETE CASCADE
)


INFO:sqlalchemy.engine.Engine:[no key 0.00083s] ()
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT category.id, category.name, category.created, category.updated 
FROM category
INFO:sqlalchemy.engine.Engine:[generated in 0.00062s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO category (name, created, updated) VALUES ($1::VARCHAR, now(), now()) RETURNING category.id, category.created, category.updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00051s] ('',)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text
INFO:sqlalchemy.engine.Engine:[generated in 0.00040s] ()
INFO:sqlalchemy.engine.Engine:INSERT INTO menu_text (name, description, created, updated) SELECT p0::VARCHAR, p1::VARCHAR, p2::TIMESTAMP WITHOUT TIME ZONE, p3::TIMESTAMP WITHOUT TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, now(), now(), 0), ($3::VARCHAR, $4::VARCHAR, now(), now(), 1), ($5::VARCHAR, $6::VARCHAR, now(), now(), 2), ($7::VARCHAR, $8::VARCHAR, now(), now(), 3)) AS imp_sen(p0, p1, p2, p3, sen_counter) ORDER BY sen_counter RETURNING menu_text.id, menu_text.created, menu_text.updated, menu_text.id AS id__1
INFO:sqlalchemy.engine.Engine:[generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] ('main', ' !', 'payment', '<b> :</b>\n\u2705   ', 'catalog', ':', 'active', '')
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT menu_text.id, menu_text.name, menu_text.description, menu_text.created, menu_text.updated 
FROM menu_text 
WHERE menu_text.name = $1::VARCHAR
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] ('main',)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782840 is handled. Duration 250 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782841 is handled. Duration 187 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00096s] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.004124s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:INSERT INTO "user" (id, created_at, username, current_subscription_id, subscription_end_date, link_sent, links_sent, daily_link_limit, created, updated) VALUES ($1::INTEGER, now(), $2::VARCHAR, $3::INTEGER, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::INTEGER, $7::INTEGER, now(), now()) RETURNING "user".created_at, "user".created, "user".updated
INFO:sqlalchemy.engine.Engine:[generated in 0.00068s] (334570076, 'mimimichaello', None, None, None, 0, 1)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 0.009779s ago] (334570076,)
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020F7C342B10>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000020F7BD27000>, 234323.093)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000020F7C342B90>
INFO:sqlalchemy.engine.Engine:UPDATE "user" SET link_sent=$1::TIMESTAMP WITHOUT TIME ZONE, updated=now() WHERE "user".id = $2::INTEGER
INFO:sqlalchemy.engine.Engine:[generated in 0.00087s] (datetime.datetime(2024, 4, 17, 14, 47, 7, 316207), 334570076)
INFO:sqlalchemy.engine.Engine:COMMIT
INFO:aiogram.event:Update id=657782842 is handled. Duration 437 ms by bot id=7128547705
INFO:aiogram.event:Update id=657782843 is handled. Duration 265 ms by bot id=7128547705
INFO:sqlalchemy.engine.Engine:BEGIN (implicit)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.174s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:SELECT "user".id, "user".created_at, "user".username, "user".current_subscription_id, "user".subscription_end_date, "user".link_sent, "user".links_sent, "user".daily_link_limit, "user".created, "user".updated 
FROM "user" 
WHERE "user".id = $1::INTEGER
INFO:sqlalchemy.engine.Engine:[cached since 4.176s ago] (334570076,)
INFO:sqlalchemy.engine.Engine:ROLLBACK
INFO:aiogram.event:Update id=657782844 is handled. Duration 125 ms by bot id=7128547705
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Polling stopped for bot @LikeeUp_bot id=7128547705 - 'LikeeUp Bot'
